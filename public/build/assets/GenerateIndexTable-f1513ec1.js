import{b as u,j as e,F as L,A as Be,a as _e,u as Fe,a7 as ye,f as We,a8 as ze,d as we,c as He,r as d,a9 as I,aa as Ue,e as Qe,L as Ge,N as se,ab as re,ac as oe,S as ce}from"./main-222e59c9.js";import{s as Se,Q as qe}from"./sortBy-c86d2308.js";import{E as Je,D as Ye,V as Ze}from"./CommonIcons-74a966c4.js";import{S as $e}from"./react-select.esm-a1c11541.js";const Ke=({option:n,handleFieldChange:l,selectedFields:f})=>u("label",{className:"flex items-center cursor-pointer",children:[e("input",{type:"checkbox",value:n.value,onChange:m=>l(m,n),checked:f.includes(n.value),className:"form-checkbox"}),e("span",{className:"text-dark",children:n.label})]}),Ne=({onChange:n,defaultValue:l})=>u(L,{children:[e("label",{className:"block text-sm text-gray-600",children:"From:"}),e("input",{defaultValue:l.from,type:"number",name:"from",className:"border p-2 w-full",onChange:n}),e("label",{className:"block text-sm text-gray-600",children:"To:"}),e("input",{defaultValue:l.to,type:"number",name:"to",className:"border p-2 w-full",onChange:n})]}),ie=({onChange:n,placeholder:l,defaultValue:f})=>u(L,{children:[e("label",{className:"block font-semibold",children:"Value:"}),e("input",{defaultValue:f.value,type:"text",placeholder:l,className:"border p-2 w-full",onChange:n})]}),Xe=({onChange:n,optionValue:l,defaultValue:f})=>u("div",{className:" mt-4",children:[e("label",{className:"block font-semibold",children:"Duration:"}),u("div",{className:"mb-2",children:[e("input",{type:"number",placeholder:"Days",className:"border p-2 w-1/2",min:"1",name:"duration",defaultValue:f.duration,onChange:m=>n(l,m,"is")}),u("select",{name:"duration_condition",className:"border p-2 w-1/2",placeholder:"Select a Condition",defaultValue:f.duration_condition,onChange:m=>n(l,m,"is"),children:[e("option",{value:"=",children:"="}),e("option",{value:"<",children:"<"}),e("option",{value:">",children:">"}),e("option",{value:"<=",children:"<="}),e("option",{value:">=",children:">="})]})]})]}),Z=({placeholder:n,onChange:l,label:f,defaultValue:m})=>u(L,{children:[e("label",{className:"block font-semibold",children:f}),e("input",{type:"text",placeholder:n,className:"border p-2 w-full",defaultValue:m.value,onChange:l})]}),ke=({onChange:n,defaultValue:l})=>u(L,{children:[e("label",{className:"block text-sm text-gray-600",children:"From:"}),e("input",{type:"date",name:"from",className:"border p-2 w-full",onChange:n,defaultValue:l.from}),e("label",{className:"block text-sm text-gray-600",children:"To:"}),e("input",{type:"date",name:"to",className:"border p-2 w-full",onChange:n,defaultValue:l.to})]}),K=({onChange:n,defaultValue:l})=>e(L,{children:u("div",{className:"flex",children:[e("input",{type:"number",placeholder:"2",className:"border p-2 w-1/2",min:"1",name:"period_val",defaultValue:l.value,onChange:n}),u("select",{name:"period",className:"border p-2 w-1/2",defaultValue:l.period,onChange:n,children:[e("option",{value:"days",children:"Days"}),e("option",{value:"weeks",children:"Weeks"}),e("option",{value:"months",children:"Months"})]})]})}),U=({onChange:n,defaultValue:l})=>e(L,{children:e("input",{defaultValue:l.value,type:"date",className:"border p-2 w-full",onChange:n})}),X=({placeholder:n,loadOptions:l,onChange:f,filterSelect:m})=>{var c;const N=(c=m==null?void 0:m.value)==null?void 0:c.fullOptions,y=N==null?void 0:N.map(r=>({value:r.value,label:r.label}));return e(Be,{defaultOptions:!0,placeholder:n,loadOptions:l,onChange:f,defaultValue:y,isMulti:!0})},ee=({options:n,condition:l,optionValue:f,isMulti:m=!1,handleSelectMultipleDuration:N,handleSelectMultiple:y,defaultValue:c})=>{const r=Object.keys(n||{}).map(i=>({value:i,label:n[i]}));c=c==null?void 0:c.options;let w;return m&&Array.isArray(c)?w=c.map(i=>({value:i,label:n[i]})):!m&&c&&(w={value:c,label:n[c]}),e($e,{placeholder:"Select an option",onChange:i=>m?y(f,i):N(f,i,l),options:r,isMulti:m,defaultValue:w})},et=new _e,tt=({filterSelect:n,option:l,setFilters:f,filters:m})=>{const N=Fe(),y=n.condition,c=l.type;if(!l.condition[y]||!l.condition[y].input)return null;const r=n.value,w=(t,a)=>{const h={...m};h[t]={...h[t],value:a},N(ze({[t]:a.value})),f(h)},i=(t,a)=>{const h={value:a.target.value};w(t,h)},T=(t,a)=>{const{name:h,value:v}=a.target,C=m[t],x=C?C.value:{},g=h==="from"?v:x.from||"",_=h==="to"?v:x.to||"";w(t,{from:g,to:_})},P=(t,a)=>{const{name:h,value:v}=a.target,C=m[t],x=C?C.value:{},g=h==="period_val"?v:x.value||2,_=h==="period"?v:x.period||"day";w(t,{value:g,period:_})},k=(t,a,h="is_not")=>{let v,C,x=n.value.duration,g=n.value.duration_condition;if(a.target!=null){const{name:_,value:A}=a.target,W=m[t],z=W?W.value:{};x=_==="duration"?A:z.duration||2,g=_==="duration_condition"?A:z.duration_condition||"=",C=z.options??[]}else C=a.map(_=>_.value);h==="is_not"?v={options:C}:h==="is"&&(v={options:C,duration:x,duration_condition:g}),w(t,v)},R=(t,a)=>{let h;Array.isArray(a)?h={options:a.map(v=>v.value),fullOptions:a,relation:l==null?void 0:l.relation_model}:h={options:[a.value],fullOptions:a,relation:l==null?void 0:l.relation_model},w(t,h)},M=(t,a)=>{const h={options:a.map(v=>v.value),fullOptions:a};w(t,h)},B=async t=>{if(t.length<2)return[];const a="userId",h="name",v="avatar_data",C="email";try{const x=await et.loadAdminUsers({search:t});return x.status?x.data.map(g=>({value:g[a],label:u("div",{className:"flex items-center",children:[e("img",{src:We(g[v]),alt:"avatar",className:"w-8 h-8 mr-2 rounded-full"}),u("div",{children:[e("div",{className:"text-sm font-bold",children:g[h]}),e("div",{className:"text-xs text-gray-500",children:g[C]})]})]},g[a])})):(console.error("An error occurred while fetching users",x.message),[])}catch(x){return console.error("An error occurred while fetching users:",x),[]}},j={number:{between:()=>e(Ne,{defaultValue:r,onChange:t=>T(l.value,t)}),not_between:()=>e(Ne,{defaultValue:r,onChange:t=>T(l.value,t)}),default:()=>e(ie,{defaultValue:r,onChange:t=>i(l.value,t),placeholder:"Search value"})},select2_multiple_duration:{is_not:()=>e(ee,{options:l.options,condition:"is_not",optionValue:l.value,handleSelectMultipleDuration:k,isMulti:!0}),is:()=>u(L,{children:[e(ee,{options:l.options,condition:"is",optionValue:l.value,isMulti:!0,defaultValue:r,handleSelectMultipleDuration:k}),e(Xe,{defaultValue:r,onChange:k,optionValue:l.value})]}),default:()=>e(ie,{defaultValue:r,onChange:t=>i(l.value,t),placeholder:"Search value that contains"})},select2_multiple_api_user:{is_not:t=>e(X,{placeholder:"Type at least 2 characters to search...",loadOptions:a=>B(a),defaultValue:r,filterSelect:n,onChange:a=>M(t.value,a)}),is:t=>e(X,{placeholder:"Type at least 2 characters to search...",loadOptions:a=>B(a),defaultValue:r,filterSelect:n,onChange:a=>M(t.value,a)}),default:t=>e(Z,{placeholder:"Search value that contains",defaultValue:r,onChange:a=>i(t.value,a),label:"Value:"})},select2_multiple_api:{is_not:t=>e(X,{placeholder:"Type at least 2 characters to search...",loadOptions:a=>ye(a,t),defaultValue:r,filterSelect:n,onChange:a=>R(t.value,a)}),is:t=>e(X,{placeholder:"Type at least 2 characters to search...",loadOptions:a=>ye(a,t),defaultValue:r,filterSelect:n,onChange:a=>R(t.value,a)}),default:t=>e(Z,{placeholder:"Search value that contains",defaultValue:r,onChange:a=>i(t.value,a),label:"Value:"})},select2_multiple:{is_not:()=>e(ee,{options:l.options,condition:"is_not",optionValue:l.value,isMulti:!0,handleSelectMultiple:R,defaultValue:r}),is:()=>e(ee,{options:l.options,condition:"is",optionValue:l.value,isMulti:!0,handleSelectMultiple:R,defaultValue:r}),default:()=>e(ie,{defaultValue:r,onChange:t=>i(l.value,t),placeholder:"Search value that contains"})},text:{between:t=>e(ke,{defaultValue:r,onChange:a=>T(t.value,a)}),in_the_last:t=>e(K,{defaultValue:r,onChange:a=>P(t.value,a)}),due_in:t=>e(K,{defaultValue:r,onChange:a=>P(t.value,a)}),on:t=>e(U,{defaultValue:r,onChange:a=>i(t.value,a)}),before:t=>e(U,{defaultValue:r,onChange:a=>i(t.value,a)}),after:t=>e(U,{defaultValue:r,onChange:a=>i(t.value,a)}),default:t=>e(Z,{placeholder:"Search value that contains",defaultValue:r,onChange:a=>i(t.value,a),label:"Value:"})},date:{between:t=>e(ke,{defaultValue:r,onChange:a=>T(t.value,a)}),in_the_last:t=>e(K,{defaultValue:r,onChange:a=>P(t.value,a)}),due_in:t=>e(K,{defaultValue:r,onChange:a=>P(t.value,a)}),on:t=>e(U,{defaultValue:r,onChange:a=>i(t.value,a)}),before:t=>e(U,{defaultValue:r,onChange:a=>i(t.value,a)}),after:t=>e(U,{defaultValue:r,onChange:a=>i(t.value,a)}),default:t=>e(Z,{placeholder:"Search value that contains",defaultValue:r,onChange:a=>i(t.value,a),label:"Value:"})}};if(j[c])return j[c][y]?j[c][y](l):j[c].default(l)},at=({option:n,handleConditionChange:l,filters:f,filterState:m,setFilters:N,filterOptionRef:y})=>{var r,w;const c=((w=(r=y==null?void 0:y.current)==null?void 0:r.filters[n.value])==null?void 0:w.condition)||null;return u("div",{children:[e("h3",{className:"text-lg font-semibold mt-4",children:"Search Options"}),u("div",{className:"mb-4",children:[u("div",{className:"mb-2",children:[u("label",{className:"block font-semibold",children:["Search include for ",n.label,":"]}),e($e,{onChange:i=>l(n.value,i),placeholder:"Select an include",options:n.conditions,defaultValue:n.conditions.find(i=>i.value==c)})]}),f[n.value]&&e("div",{className:"mb-2",children:e(tt,{filterOptionRef:y,filterSelect:f[n.value],option:n,setFilters:N,filters:f,filterState:m})})]})]})},ot=({modelName:n,tableColumns:l,frontRoute:f,actionPlus:m=[]})=>{const N=Fe(),y=we(s=>s.filters),{hasPermission:c,isLoading:r,isLoggedIn:w}=He(),[i,T]=d.useState(!0),[P,k]=d.useState(!0),[R,M]=d.useState(!0),[B,j]=d.useState(!0),[t,a]=d.useState(!1),h=new _e,v=we(s=>s.themeConfig.theme)==="dark",[C,x]=d.useState([]),[g,_]=d.useState([]),[A,W]=d.useState([]),[z,de]=d.useState(""),[D,Q]=d.useState([]),[V,G]=d.useState(1),te=[50,100],[F,Ee]=d.useState(te[0]),[q,Ie]=d.useState(Se(C,"id")),[ae,Le]=d.useState(q),[ue,ne]=d.useState([]),[Ae,De]=d.useState(0),[E,Ve]=d.useState({columnAccessor:"created_at",direction:"desc"}),$=d.useRef(),Oe=async()=>{var s;try{M(!0);const p=(s=(await re("filterOption").call(h,{model:oe(n)})).data)==null?void 0:s.data.map(S=>{const b=S.condition;return{...S,conditions:Object.entries(b).map(([O,Y])=>({value:O,label:Y.value,input:Y.input,type:Y.type,model:S.model}))}});_(p)}catch(o){J("Error fetching filter options.","error"),console.error("Error fetching data:",o),M(!1)}},he=()=>{window.scrollTo({top:0,behavior:"smooth"})},pe=({page:s,pageSize:o,filters:p,sortStatus:S})=>{a(!1),he(),le(s,o,p,S)};let me=[];g&&g.length>0&&(me=g.filter(s=>s.label.toLowerCase().includes(z.toLowerCase())));const J=(s="",o="success")=>{ce.mixin({toast:!0,position:"top",showConfirmButton:!1,timer:3e3,customClass:{container:"toast"}}).fire({icon:o,title:s,padding:"10px 20px"})},fe=(s=null)=>{ce.fire({icon:"warning",title:"Are you sure?",text:"You won't be able to revert this!",showCancelButton:!0,confirmButtonText:"Delete",padding:"2em",customClass:"sweet-alerts"}).then(o=>{o.value&&(s?(ge(s),ne([])):((ue||[]).map(b=>b.id).forEach(b=>ge(b)),ne([]),G(1)),ce.fire({title:"Deleted!",text:"Row has been deleted.",icon:"success",customClass:"sweet-alerts"}))})},ge=async s=>{try{k(!0),re(`deleteSingle${oe(n)}`).call(h,s).then(o=>{const p=o.data;p.status?pe($.current):(J(`Error deleting the ${n}: `+p.message,"error"),console.error(`Error deleting the ${n} : `,p.message))})}catch(o){J("Error making delete request","error"),console.error("Error making delete request",o),k(!1)}},le=async(s=1,o=te[0],p=[],S={})=>{k(!0);const{columnAccessor:b="",direction:O=""}=S,Y=encodeURIComponent(JSON.stringify(p));try{re(`fetchData${oe(n)}`).call(h,{page:s,pageSize:o,sortField:b,sortDirection:O,filterParam:Y}).then(H=>{var ve,be,Ce,xe;x((be=(ve=H.data)==null?void 0:ve.data)==null?void 0:be.data),De((xe=(Ce=H.data)==null?void 0:Ce.data)==null?void 0:xe.total)}).catch(H=>{console.error("Error fetching data: ",H),j(!B),J(`Error fetching  ${n} data.`,"error")})}catch(H){J(`Error fetching ${n} data.`,"error"),console.error("Error fetching data: ",H),j(!B)}},Te=()=>{W([]),Q([]),de(""),G(1),a(!0),he()},Me=(s,o)=>{const{value:p,checked:S}=s.target;S?(Q(b=>({...b,[p]:{field:p,condition:"",value:"",model:o.model,type:o.type}})),W(b=>[...b,p])):(Q(b=>{const O={...b};return delete O[p],O}),W(b=>b.filter(O=>O!==p)))},je=s=>{const{columnAccessor:o,direction:p="desc"}=s;Ve({columnAccessor:o,direction:p}),G(1),le(V,F,D,{columnAccessor:o,direction:p})},Pe=(s,o)=>{const p=["between","in_the_last","due_in"];let S={...D[s],condition:o.value};p.includes(S.condition)&&(S.value="");const b={...D,[s]:S};Q(b)};d.useEffect(()=>{const s=Se(C,E.columnAccessor),o=E.direction!=="asc"?s.reverse():s;$.current={...$.current,sortStatus:E},Ie(o)},[C,E]),d.useEffect(()=>{G(1)},[F]),d.useEffect(()=>{Le([...q.slice(0,F)]),$.current={...$.current,page:V,pageSize:F}},[V,F,q]),d.useEffect(()=>{M(!0),g.length>0&&M(!1)},[g]),d.useEffect(()=>{k(!0),ae.length>=0&&k(!1),q.length>0&&k(!1)},[ae,q,B]),d.useEffect(()=>{$.current={...$.current,page:V,pageSize:F,sortStatus:E},le(V,F,D,E)},[V,F,E,t]),d.useEffect(()=>{$.current={...$.current,filters:D}},[D]),d.useEffect(()=>{!r&&!c(`filter-${I(n)}`)&&!c(`read-${I(n)}`)&&T(!0),T(!1)},[r,w,c]),d.useEffect(()=>{Oe(),N(Ue())},[]);const Re=u("button",{type:"button",className:"btn btn-danger gap-2",onClick:()=>fe(),children:[u("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",children:[e("path",{d:"M20.5001 6H3.5",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"}),e("path",{d:"M18.8334 8.5L18.3735 15.3991C18.1965 18.054 18.108 19.3815 17.243 20.1907C16.378 21 15.0476 21 12.3868 21H11.6134C8.9526 21 7.6222 21 6.75719 20.1907C5.89218 19.3815 5.80368 18.054 5.62669 15.3991L5.16675 8.5",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"}),e("path",{opacity:"0.5",d:"M9.5 11L10 16",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"}),e("path",{opacity:"0.5",d:"M14.5 11L14 16",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"}),e("path",{opacity:"0.5",d:"M6.5 6C6.55588 6 6.58382 6 6.60915 5.99936C7.43259 5.97849 8.15902 5.45491 8.43922 4.68032C8.44784 4.65649 8.45667 4.62999 8.47434 4.57697L8.57143 4.28571C8.65431 4.03708 8.69575 3.91276 8.75071 3.8072C8.97001 3.38607 9.37574 3.09364 9.84461 3.01877C9.96213 3 10.0932 3 10.3553 3H13.6447C13.9068 3 14.0379 3 14.1554 3.01877C14.6243 3.09364 15.03 3.38607 15.2493 3.8072C15.3043 3.91276 15.3457 4.03708 15.4286 4.28571L15.5257 4.57697C15.5433 4.62992 15.5522 4.65651 15.5608 4.68032C15.841 5.45491 16.5674 5.97849 17.3909 5.99936C17.4162 6 17.4441 6 17.5 6",stroke:"currentColor",strokeWidth:"1.5"})]}),"Delete"]});return!c(`read-${I(n)}`)||i?e(Qe,{}):e(L,{children:e("div",{className:"panel px-0 border-white-light dark:border-[#1b2e4b]",children:u("div",{className:`${n}-table`,children:[e("div",{className:"mb-4.5 px-5 flex md:items-center md:flex-row flex-col gap-5",children:u("div",{className:"flex items-center gap-2",children:[c(`delete-${I(n)}`)&&Re,c(`create-${I(n)}`)&&e(Ge,{to:`/${f??n}/add`,className:"btn btn-primary gap-2",children:"Add New"})]})}),u("div",{className:"grid grid-cols-7 gap-6 mb-6",children:[c(`filter-${I(n)}`)&&u("div",{className:"panel col-span-1",children:[e("h2",{className:"text-xl font-bold mb-4",children:"Filter By Fields"}),e("div",{className:"mb-4",children:e("input",{type:"text",placeholder:"Search fields...",className:"border p-2 w-full",value:z,onChange:s=>de(s.target.value)})}),u("div",{className:"mb-4",children:[e("label",{className:"block font-semibold",children:"Filter by:"}),R?e("div",{className:"flex justify-center",children:e("span",{className:"animate-spin border-4 my-4 border-primary border-l-transparent rounded-full w-12 h-12 inline-block align-middle m-auto mb-10"})}):e("div",{children:me.map((s,o)=>u("div",{children:[e(Ke,{option:s,handleFieldChange:Me,selectedFields:A}),A.includes(s.value)&&e(at,{option:s,handleConditionChange:Pe,filters:D,filterState:y,setFilters:Q,filterOptionRef:$})]},s.value+o))})]}),A.length>0&&u("div",{className:"flex justify-between space-x-2  ",style:{position:"fixed",left:-58,zIndex:99999,top:"50vh",transform:"rotate(90deg)"},children:[e("button",{onClick:()=>pe({page:V,pageSize:F,filters:D,sortStatus:E}),className:"btn btn-sm btn-primary",children:"Apply Filter"}),e("button",{onClick:Te,className:"btn btn-sm btn-dark",children:"Reset"})]})]}),e("div",{className:"panel col-span-6",children:e("div",{className:"datatables pagination-padding",children:P?e("div",{className:"flex justify-center",children:e("span",{className:"animate-spin border-4 my-4 border-primary border-l-transparent rounded-full w-12 h-12 inline-block align-middle m-auto mb-10"})}):e(qe,{className:`${v} whitespace-nowrap table-hover`,records:ae,columns:[...l,{accessor:"action",title:"Actions",sortable:!1,textAlignment:"center",render:({id:s})=>e(L,{children:u("div",{className:"flex gap-4 items-center w-max mx-auto",children:[c(`update-${I(n)}`)&&e(se,{to:`/${f??n}/edit/${s}`,className:"flex hover:text-info",children:e(Je,{})}),c(`delete-${I(n)}`)&&e("button",{type:"button",className:"flex hover:text-danger",onClick:()=>fe(s),children:e(Ye,{})}),c(`read-${I(n)}`)&&e(se,{to:`/${f??n}/preview/${s}`,className:"flex hover:text-info",children:e(Ze,{})}),m.map((o,p)=>e(se,{to:`/${o.route}/${s}`,className:"flex hover:text-info",children:o.icon},`${s}-${p}`))]})})}],highlightOnHover:!0,totalRecords:Ae,recordsPerPage:F,page:V,onPageChange:G,recordsPerPageOptions:te,onRecordsPerPageChange:Ee,sortStatus:E,onSortStatusChange:je,selectedRecords:ue,onSelectedRecordsChange:ne,paginationText:({from:s,to:o,totalRecords:p})=>`Showing ${s} to ${o} of ${p} entries`})})})]})]})})})};export{ot as G};
