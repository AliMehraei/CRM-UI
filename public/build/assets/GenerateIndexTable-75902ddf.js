import{j as i,b as e,F as A,e as be,u as Ce,a5 as he,a6 as Ve,a as pe,c as Oe,r as g,a7 as I,a8 as Me,d as Te,L as Pe,N as me,a9 as K,aa as X,S as ee}from"./main-50485d15.js";import{s as ve,Q as je}from"./sortBy-58fa217b.js";import{E as Re,D as Be,V as We}from"./CommonIcons-7e70d001.js";import{S as xe}from"./react-select.esm-57321b92.js";import{A as ze}from"./react-select-async.esm-53710751.js";const He=({option:n,handleFieldChange:s,selectedFields:m})=>i("label",{className:"flex items-center cursor-pointer",children:[e("input",{type:"checkbox",value:n.value,onChange:u=>s(u,n),checked:m.includes(n.value),className:"form-checkbox"}),e("span",{className:"text-dark",children:n.label})]}),fe=({onChange:n,defaultValue:s})=>i(A,{children:[e("label",{className:"block text-sm text-gray-600",children:"From:"}),e("input",{defaultValue:s.from,type:"number",name:"from",className:"border p-2 w-full",onChange:n}),e("label",{className:"block text-sm text-gray-600",children:"To:"}),e("input",{defaultValue:s.to,type:"number",name:"to",className:"border p-2 w-full",onChange:n})]}),te=({onChange:n,placeholder:s,defaultValue:m})=>i(A,{children:[e("label",{className:"block font-semibold",children:"Value:"}),e("input",{defaultValue:m.value,type:"text",placeholder:s,className:"border p-2 w-full",onChange:n})]}),Ue=({onChange:n,optionValue:s,defaultValue:m})=>i("div",{className:" mt-4",children:[e("label",{className:"block font-semibold",children:"Duration:"}),i("div",{className:"mb-2",children:[e("input",{type:"number",placeholder:"Days",className:"border p-2 w-1/2",min:"1",name:"duration",defaultValue:m.duration,onChange:u=>n(s,u,"is")}),i("select",{name:"duration_condition",className:"border p-2 w-1/2",placeholder:"Select a Condition",defaultValue:m.duration_condition,onChange:u=>n(s,u,"is"),children:[e("option",{value:"=",children:"="}),e("option",{value:"<",children:"<"}),e("option",{value:">",children:">"}),e("option",{value:"<=",children:"<="}),e("option",{value:">=",children:">="})]})]})]}),U=({placeholder:n,onChange:s,label:m,defaultValue:u})=>i(A,{children:[e("label",{className:"block font-semibold",children:m}),e("input",{type:"text",placeholder:n,className:"border p-2 w-full",defaultValue:u.value,onChange:s})]}),ge=({onChange:n,defaultValue:s})=>i(A,{children:[e("label",{className:"block text-sm text-gray-600",children:"From:"}),e("input",{type:"date",name:"from",className:"border p-2 w-full",onChange:n,defaultValue:s.from}),e("label",{className:"block text-sm text-gray-600",children:"To:"}),e("input",{type:"date",name:"to",className:"border p-2 w-full",onChange:n,defaultValue:s.to})]}),Q=({onChange:n,defaultValue:s})=>e(A,{children:i("div",{className:"flex",children:[e("input",{type:"number",placeholder:"2",className:"border p-2 w-1/2",min:"1",name:"period_val",defaultValue:s.value,onChange:n}),i("select",{name:"period",className:"border p-2 w-1/2",defaultValue:s.period,onChange:n,children:[e("option",{value:"days",children:"Days"}),e("option",{value:"weeks",children:"Weeks"}),e("option",{value:"months",children:"Months"})]})]})}),B=({onChange:n,defaultValue:s})=>e(A,{children:e("input",{defaultValue:s.value,type:"date",className:"border p-2 w-full",onChange:n})}),G=({placeholder:n,loadOptions:s,onChange:m,filterSelect:u})=>{var f;const _=(f=u==null?void 0:u.value)==null?void 0:f.fullOptions,h=_==null?void 0:_.map(r=>({value:r.value,label:r.label}));return e(ze,{defaultOptions:!0,placeholder:n,loadOptions:s,onChange:m,defaultValue:h,isMulti:!0})},q=({options:n,condition:s,optionValue:m,isMulti:u=!1,handleSelectMultipleDuration:_,handleSelectMultiple:h,defaultValue:f})=>{const r=Object.keys(n||{}).map(o=>({value:o,label:n[o]}));f=f==null?void 0:f.options;let y;return u&&Array.isArray(f)?y=f.map(o=>({value:o,label:n[o]})):!u&&f&&(y={value:f,label:n[f]}),e(xe,{placeholder:"Select an option",onChange:o=>u?h(m,o):_(m,o,s),options:r,isMulti:u,defaultValue:y})},Qe=new be,Ge=({filterSelect:n,option:s,setFilters:m,filters:u})=>{const _=Ce(),h=n.condition,f=s.type;if(!s.condition[h]||!s.condition[h].input)return null;const r=n.value,y=(a,t)=>{const d={...u};d[a]={...d[a],value:t},_(Ve({[a]:t.value})),m(d)},o=(a,t)=>{const d={value:t.target.value};y(a,d)},M=(a,t)=>{const{name:d,value:b}=t.target,S=u[a],v=S?S.value:{},C=d==="from"?b:v.from||"",x=d==="to"?b:v.to||"";y(a,{from:C,to:x})},V=(a,t)=>{const{name:d,value:b}=t.target,S=u[a],v=S?S.value:{},C=d==="period_val"?b:v.value||2,x=d==="period"?b:v.period||"day";y(a,{value:C,period:x})},O=(a,t,d="is_not")=>{let b,S,v=n.value.duration,C=n.value.duration_condition;if(t.target!=null){const{name:x,value:F}=t.target,j=u[a],N=j?j.value:{};v=x==="duration"?F:N.duration||2,C=x==="duration_condition"?F:N.duration_condition||"=",S=N.options??[]}else S=t.map(x=>x.value);d==="is_not"?b={options:S}:d==="is"&&(b={options:S,duration:v,duration_condition:C}),y(a,b)},T=(a,t)=>{let d;Array.isArray(t)?d={options:t.map(b=>b.value),fullOptions:t,relation:s==null?void 0:s.relation_model}:d={options:[t.value],fullOptions:t,relation:s==null?void 0:s.relation_model},y(a,d)},P=(a,t)=>{const d={options:t.map(b=>b.value),fullOptions:t};y(a,d)},H=async a=>{if(a.length<2)return[];const t="id",d="name",b="avatar",S="email";try{const v=await Qe.loadAdminUsers({search:a});return v.status?v.data.map(C=>({value:C[t],label:i("div",{className:"flex items-center",children:[e("img",{src:C[b],alt:"avatar",className:"w-8 h-8 mr-2 rounded-full"}),i("div",{children:[e("div",{className:"text-sm font-bold",children:C[d]}),e("div",{className:"text-xs text-gray-500",children:C[S]})]})]},C[t])})):(console.error("An error occurred while fetching users",v.message),[])}catch(v){return console.error("An error occurred while fetching users:",v),[]}},D={number:{between:()=>e(fe,{defaultValue:r,onChange:a=>M(s.value,a)}),not_between:()=>e(fe,{defaultValue:r,onChange:a=>M(s.value,a)}),default:()=>e(te,{defaultValue:r,onChange:a=>o(s.value,a),placeholder:"Search value"})},select2_multiple_duration:{is_not:()=>e(q,{options:s.options,condition:"is_not",optionValue:s.value,handleSelectMultipleDuration:O,isMulti:!0}),is:()=>i(A,{children:[e(q,{options:s.options,condition:"is",optionValue:s.value,isMulti:!0,defaultValue:r,handleSelectMultipleDuration:O}),e(Ue,{defaultValue:r,onChange:O,optionValue:s.value})]}),default:()=>e(te,{defaultValue:r,onChange:a=>o(s.value,a),placeholder:"Search value that contains"})},select2_multiple_api_user:{is_not:a=>e(G,{placeholder:"Type at least 2 characters to search...",loadOptions:t=>H(t),defaultValue:r,filterSelect:n,onChange:t=>P(a.value,t)}),is:a=>e(G,{placeholder:"Type at least 2 characters to search...",loadOptions:t=>H(t),defaultValue:r,filterSelect:n,onChange:t=>P(a.value,t)}),default:a=>e(U,{placeholder:"Search value that contains",defaultValue:r,onChange:t=>o(a.value,t),label:"Value:"})},select2_multiple_api:{is_not:a=>e(G,{placeholder:"Type at least 2 characters to search...",loadOptions:t=>he(t,a),defaultValue:r,filterSelect:n,onChange:t=>T(a.value,t)}),is:a=>e(G,{placeholder:"Type at least 2 characters to search...",loadOptions:t=>he(t,a),defaultValue:r,filterSelect:n,onChange:t=>T(a.value,t)}),default:a=>e(U,{placeholder:"Search value that contains",defaultValue:r,onChange:t=>o(a.value,t),label:"Value:"})},select2_multiple:{is_not:()=>e(q,{options:s.options,condition:"is_not",optionValue:s.value,isMulti:!0,handleSelectMultiple:T,defaultValue:r}),is:()=>e(q,{options:s.options,condition:"is",optionValue:s.value,isMulti:!0,handleSelectMultiple:T,defaultValue:r}),default:()=>e(te,{defaultValue:r,onChange:a=>o(s.value,a),placeholder:"Search value that contains"})},text:{between:a=>e(ge,{defaultValue:r,onChange:t=>M(a.value,t)}),in_the_last:a=>e(Q,{defaultValue:r,onChange:t=>V(a.value,t)}),due_in:a=>e(Q,{defaultValue:r,onChange:t=>V(a.value,t)}),on:a=>e(B,{defaultValue:r,onChange:t=>o(a.value,t)}),before:a=>e(B,{defaultValue:r,onChange:t=>o(a.value,t)}),after:a=>e(B,{defaultValue:r,onChange:t=>o(a.value,t)}),default:a=>e(U,{placeholder:"Search value that contains",defaultValue:r,onChange:t=>o(a.value,t),label:"Value:"})},date:{between:a=>e(ge,{defaultValue:r,onChange:t=>M(a.value,t)}),in_the_last:a=>e(Q,{defaultValue:r,onChange:t=>V(a.value,t)}),due_in:a=>e(Q,{defaultValue:r,onChange:t=>V(a.value,t)}),on:a=>e(B,{defaultValue:r,onChange:t=>o(a.value,t)}),before:a=>e(B,{defaultValue:r,onChange:t=>o(a.value,t)}),after:a=>e(B,{defaultValue:r,onChange:t=>o(a.value,t)}),default:a=>e(U,{placeholder:"Search value that contains",defaultValue:r,onChange:t=>o(a.value,t),label:"Value:"})}};if(D[f])return D[f][h]?D[f][h](s):D[f].default(s)},qe=({option:n,handleConditionChange:s,filters:m,filterState:u,setFilters:_,filterOptionRef:h})=>{var r,y;const f=((y=(r=h==null?void 0:h.current)==null?void 0:r.filters[n.value])==null?void 0:y.condition)||null;return i("div",{children:[e("h3",{className:"text-lg font-semibold mt-4",children:"Search Options"}),i("div",{className:"mb-4",children:[i("div",{className:"mb-2",children:[i("label",{className:"block font-semibold",children:["Search include for ",n.label,":"]}),e(xe,{onChange:o=>s(n.value,o),placeholder:"Select an include",options:n.conditions,defaultValue:n.conditions.find(o=>o.value==f)})]}),m[n.value]&&e("div",{className:"mb-2",children:e(Ge,{filterOptionRef:h,filterSelect:m[n.value],option:n,setFilters:_,filters:m,filterState:u})})]})]})},et=({modelName:n,tableColumns:s,frontRoute:m})=>{const u=Ce(),_=pe(l=>l.filters),{hasPermission:h,isLoading:f,isLoggedIn:r}=Oe(),[y,o]=g.useState(!1),[M,V]=g.useState(!1),O=new be,T=pe(l=>l.themeConfig.theme)==="dark",[P,H]=g.useState([]),[D,a]=g.useState([]),[t,d]=g.useState([]),[b,S]=g.useState(""),[v,C]=g.useState([]),[x,F]=g.useState(1),j=[50,100],[N,we]=g.useState(j[0]),[J,ye]=g.useState(ve(P,"id")),[Se,Ne]=g.useState(J),[ae,Y]=g.useState([]),[ke,_e]=g.useState(0),[E,Fe]=g.useState({columnAccessor:"id",direction:"asc"}),$=g.useRef(),$e=async()=>{var l;o(!0);try{const p=(l=(await K("filterOption").call(O,{model:X(n)})).data)==null?void 0:l.data.map(k=>{const w=k.condition;return{...k,conditions:Object.entries(w).map(([L,z])=>({value:L,label:z.value,input:z.input,type:z.type,model:k.model}))}});a(p)}catch(c){W("Error fetching filter options.","error"),console.error("Error fetching data:",c)}o(!1)},ne=()=>{window.scrollTo({top:0,behavior:"smooth"})},se=({page:l,pageSize:c,filters:p,sortStatus:k})=>{V(!1),ne(),Z(l,c,p,k)};let le=[];D&&D.length>0&&(le=D.filter(l=>l.label.toLowerCase().includes(b.toLowerCase())));const W=(l="",c="success")=>{ee.mixin({toast:!0,position:"top",showConfirmButton:!1,timer:3e3,customClass:{container:"toast"}}).fire({icon:c,title:l,padding:"10px 20px"})},re=(l=null)=>{ee.fire({icon:"warning",title:"Are you sure?",text:"You won't be able to revert this!",showCancelButton:!0,confirmButtonText:"Delete",padding:"2em",customClass:"sweet-alerts"}).then(c=>{c.value&&(l?(oe(l),Y([])):((ae||[]).map(w=>w.id).forEach(w=>oe(w)),Y([]),F(1)),ee.fire({title:"Deleted!",text:"Row has been deleted.",icon:"success",customClass:"sweet-alerts"}))})},oe=async l=>{try{o(!0),K(`deleteSingle${X(n)}`).call(O,l).then(c=>{const p=c.data;p.status?se($.current):(W(`Error deleting the ${n}: `+p.message,"error"),console.error(`Error deleting the ${n} : `,p.message))}),o(!1)}catch(c){W("Error making delete request","error"),console.error("Error making delete request",c),o(!1)}},Z=async(l=1,c=j[0],p=[],k={})=>{o(!0);const{columnAccessor:w="",direction:L=""}=k,z=encodeURIComponent(JSON.stringify(p));try{K(`fetchData${X(n)}`).call(O,{page:l,pageSize:c,sortField:w,sortDirection:L,filterParam:z}).then(R=>{var ce,ie,de,ue;H((ie=(ce=R.data)==null?void 0:ce.data)==null?void 0:ie.data),_e((ue=(de=R.data)==null?void 0:de.data)==null?void 0:ue.total),o(!1)}).catch(R=>{console.error("Error fetching data: ",R),o(!1),W(`Error fetching  ${n} data.`,"error")})}catch(R){W(`Error fetching ${n} data.`,"error"),console.error("Error fetching data: ",R),o(!1)}},Ee=()=>{d([]),C([]),S(""),F(1),V(!0),ne()},Ie=(l,c)=>{const{value:p,checked:k}=l.target;k?(C(w=>({...w,[p]:{field:p,condition:"",value:"",model:c.model,type:c.type}})),d(w=>[...w,p])):(C(w=>{const L={...w};return delete L[p],L}),d(w=>w.filter(L=>L!==p)))},Ae=l=>{const{columnAccessor:c,direction:p="asc"}=l;Fe({columnAccessor:c,direction:p}),F(1),Z(x,N,v,{columnAccessor:c,direction:p})},De=(l,c)=>{const p=["between","in_the_last","due_in"];let k={...v[l],condition:c.value};p.includes(k.condition)&&(k.value="");const w={...v,[l]:k};C(w)};g.useEffect(()=>{const l=ve(P,E.columnAccessor),c=E.direction!=="asc"?l.reverse():l;$.current={...$.current,sortStatus:E},ye(c)},[P,E]),g.useEffect(()=>{F(1)},[N]),g.useEffect(()=>{Ne([...J.slice(0,N)]),$.current={...$.current,page:x,pageSize:N}},[x,N,J]),g.useEffect(()=>{$.current={...$.current,page:x,pageSize:N,sortStatus:E},Z(x,N,v,E)},[x,N,E,M]),g.useEffect(()=>{$.current={...$.current,filters:v}},[v]),g.useEffect(()=>{!f&&!h(`filter-${I(n)}`)&&!h(`read-${I(n)}`)&&o(!0),o(!1)},[f,r,h]),g.useEffect(()=>{$e(),u(Me())},[]);const Le=i("button",{type:"button",className:"btn btn-danger gap-2",onClick:()=>re(),children:[i("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",children:[e("path",{d:"M20.5001 6H3.5",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"}),e("path",{d:"M18.8334 8.5L18.3735 15.3991C18.1965 18.054 18.108 19.3815 17.243 20.1907C16.378 21 15.0476 21 12.3868 21H11.6134C8.9526 21 7.6222 21 6.75719 20.1907C5.89218 19.3815 5.80368 18.054 5.62669 15.3991L5.16675 8.5",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"}),e("path",{opacity:"0.5",d:"M9.5 11L10 16",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"}),e("path",{opacity:"0.5",d:"M14.5 11L14 16",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"}),e("path",{opacity:"0.5",d:"M6.5 6C6.55588 6 6.58382 6 6.60915 5.99936C7.43259 5.97849 8.15902 5.45491 8.43922 4.68032C8.44784 4.65649 8.45667 4.62999 8.47434 4.57697L8.57143 4.28571C8.65431 4.03708 8.69575 3.91276 8.75071 3.8072C8.97001 3.38607 9.37574 3.09364 9.84461 3.01877C9.96213 3 10.0932 3 10.3553 3H13.6447C13.9068 3 14.0379 3 14.1554 3.01877C14.6243 3.09364 15.03 3.38607 15.2493 3.8072C15.3043 3.91276 15.3457 4.03708 15.4286 4.28571L15.5257 4.57697C15.5433 4.62992 15.5522 4.65651 15.5608 4.68032C15.841 5.45491 16.5674 5.97849 17.3909 5.99936C17.4162 6 17.4441 6 17.5 6",stroke:"currentColor",strokeWidth:"1.5"})]}),"Delete"]});return!h(`read-${I(n)}`)||y?e(Te,{}):e(A,{children:e("div",{className:"panel px-0 border-white-light dark:border-[#1b2e4b]",children:i("div",{className:`${n}-table`,children:[e("div",{className:"mb-4.5 px-5 flex md:items-center md:flex-row flex-col gap-5",children:i("div",{className:"flex items-center gap-2",children:[h(`delete-${I(n)}`)&&Le,h(`create-${I(n)}`)&&e(Pe,{to:`/${m??n}/add`,className:"btn btn-primary gap-2",children:"Add New"})]})}),i("div",{className:"grid grid-cols-7 gap-6 mb-6",children:[h(`filter-${I(n)}`)&&i("div",{className:"panel col-span-1",children:[e("h2",{className:"text-xl font-bold mb-4",children:"Filter By Fields"}),e("div",{className:"mb-4",children:e("input",{type:"text",placeholder:"Search fields...",className:"border p-2 w-full",value:b,onChange:l=>S(l.target.value)})}),i("div",{className:"mb-4",children:[e("label",{className:"block font-semibold",children:"Filter by:"}),le.map((l,c)=>i("div",{children:[e(He,{option:l,handleFieldChange:Ie,selectedFields:t}),t.includes(l.value)&&e(qe,{option:l,handleConditionChange:De,filters:v,filterState:_,setFilters:C,filterOptionRef:$})]},l.value+c))]}),t.length>0&&i("div",{className:"flex justify-between space-x-2  ",style:{position:"fixed",left:-58,zIndex:99999,top:"50vh",transform:"rotate(90deg)"},children:[e("button",{onClick:()=>se({page:x,pageSize:N,filters:v,sortStatus:E}),className:"btn btn-sm btn-primary",children:"Apply Filter"}),e("button",{onClick:Ee,className:"btn btn-sm btn-dark",children:"Reset"})]})]}),e("div",{className:"panel col-span-6",children:e("div",{className:"datatables pagination-padding",children:y?e("div",{className:"flex justify-center",children:e("span",{className:"animate-spin border-4 my-4 border-success border-l-transparent rounded-full w-12 h-12 inline-block align-middle m-auto mb-10"})}):e(je,{className:`${T} whitespace-nowrap table-hover`,records:Se,columns:[...s,{accessor:"action",title:"Actions",sortable:!1,textAlignment:"center",render:({id:l})=>e(A,{children:i("div",{className:"flex gap-4 items-center w-max mx-auto",children:[h(`update-${I(n)}`)&&e(me,{to:`/${m??n}/edit/${l}`,className:"flex hover:text-info",children:e(Re,{})}),h(`delete-${I(n)}`)&&e("button",{type:"button",className:"flex hover:text-danger",onClick:()=>re(l),children:e(Be,{})}),h(`read-${I(n)}`)&&e(me,{to:`/${m??n}/preview/${l}`,className:"flex hover:text-info",children:e(We,{})})]})})}],highlightOnHover:!0,totalRecords:ke,recordsPerPage:N,page:x,onPageChange:F,recordsPerPageOptions:j,onRecordsPerPageChange:we,sortStatus:E,onSortStatusChange:Ae,selectedRecords:ae,onSelectedRecordsChange:Y,paginationText:({from:l,to:c,totalRecords:p})=>`Showing ${l} to ${c} of ${p} entries`})})})]})]})})})};export{et as G};
