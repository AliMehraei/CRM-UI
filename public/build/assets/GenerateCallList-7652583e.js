import{u as se,d as j,c as ae,r as s,j as t,e as re,F as E,b,a as O,S as oe}from"./main-cc930730.js";import{s as I,Q as le}from"./sortBy-e6be9ca1.js";import{V as ne}from"./CommonIcons-0c4cb687.js";import{E as ce}from"./GenerateEmailLogList-c6ada5f2.js";const be=({permissionName:i,type:ie,routeName:R,modelId:k,title:g})=>{se(),j(e=>e.filters);const{hasPermission:D,isLoading:de,isLoggedIn:me}=ae(),[S,d]=s.useState(!0);s.useState(!1);const A=new O,M=j(e=>e.themeConfig.theme)==="dark",[m,L]=s.useState([]);s.useState([]),s.useState([]),s.useState(""),s.useState([]);const[c,u]=s.useState(1),f=[50,100],[o,z]=s.useState(f[0]),[h,T]=s.useState(I(m,"id")),[B,F]=s.useState(h),[G,V]=s.useState([]),[Q,H]=s.useState(0),U=new O,[l,W]=s.useState({columnAccessor:"id",direction:"asc"}),[Z,v]=s.useState(!1),[p,q]=s.useState(null);let x={leftObjects:[],rightObjects:[]};const J=e=>{var a,r;x={leftObjects:[{label:"Callable Type",value:`${e.callable_type??""}`},{label:"Relatable Type",value:`${e.relatable_type??""}`},{label:"Modifier",value:`${((a=e.modifier)==null?void 0:a.first_name)??""} ${((r=e.modifier)==null?void 0:r.last_name)??""}`},{label:"Voice Recording",value:`${e.voice_recording??""}`}],rightObjects:[{label:"Call Purpose",value:`${e.call_purpose??""}`},{label:"Call Agenda",value:`${e.call_agenda??""}`},{label:"Call Result",value:`${e.call_result??""}`},{label:"Description",value:`${(e.description??"").substring(0,50)}${e.description&&e.description.length>15?"...":""}`}]},q(x),v(!0)},K=async e=>{const a=await U.fetchSingleCall(e);if(a.status!=200)return;const r=a.data.data.call;J(r)},C=()=>{v(!1)},X=[{accessor:"Subject",sortable:!0,render:({subject:e,id:a})=>t("div",{className:"font-semibold",children:`#${e}`})},{accessor:"type",sortable:!0,render:({type:e})=>t("div",{className:"flex items-center font-semibold",children:e})},{accessor:"owner",title:"Call Owner",sortable:!1,render:({owner:e})=>t("div",{className:"flex items-center font-semibold",children:e?e.first_name+" "+e.last_name:"No Owner"})},{accessor:"call_start_time",title:"Call data",sortable:!0,render:({call_start_time:e})=>t("div",{className:"flex items-center font-semibold",children:e})},{accessor:"call_duration",title:"Duration",sortable:!0,render:({call_duration:e})=>t("div",{className:"flex items-center font-semibold",children:e})},{accessor:"outgoing_call_status",title:"Status",sortable:!0,render:({outgoing_call_status:e})=>t("div",{className:"flex items-center font-semibold",children:e})},{accessor:"created_by_id",title:"Creator",sortable:!0,render:({creator:e})=>t("div",{className:"flex items-center font-semibold",children:e?e.first_name+" "+e.last_name:"No Creator"})},{accessor:"action",sortable:!1,render:({id:e})=>t("button",{type:"button",className:"flex hover:text-danger",onClick:()=>K(e),children:t(ne,{})})}],w=(e="",a="success")=>{oe.mixin({toast:!0,position:"top",showConfirmButton:!1,timer:3e3,customClass:{container:"toast"}}).fire({icon:a,title:e,padding:"10px 20px"})},y=async(e=1,a=f[0],r={})=>{d(!0);const{columnAccessor:ee="",direction:te=""}=r;try{await A[R]({page:e,pageSize:a,sortField:ee,sortDirection:te,modelId:k}).then(n=>{var N,_,$,P;L((_=(N=n.data)==null?void 0:N.data)==null?void 0:_.data),H((P=($=n.data)==null?void 0:$.data)==null?void 0:P.total),d(!1)}).catch(n=>{console.error("Error fetching data: ",n),d(!1),w(`Error fetching  ${i} data.`,"error")})}catch(n){w(`Error fetching ${i} data.`,"error"),console.error("Error fetching data: ",n),d(!1)}},Y=e=>{const{columnAccessor:a,direction:r="asc"}=e;W({columnAccessor:a,direction:r}),u(1),y(c,o,{columnAccessor:a,direction:r})};return s.useEffect(()=>{const e=I(m,l.columnAccessor),a=l.direction!=="asc"?e.reverse():e;T(a)},[m,l]),s.useEffect(()=>{u(1)},[o]),s.useEffect(()=>{F([...h.slice(0,o)])},[c,o,h]),s.useEffect(()=>{y(c,o,l)},[c,o,l]),!D(`${i}`)||S?t(re,{}):t(E,{children:t("div",{className:" px-0 ",children:b("div",{className:`${i}-table`,children:[t("div",{className:"text-base mb-5",children:g?`${g}`:t("div",{className:""})}),t("div",{className:"grid grid-cols-1 gap-6 m-0 ",children:t("div",{className:"panel col-span-12",children:t("div",{className:"datatables pagination-padding",children:S?t("div",{className:"flex justify-center",children:t("span",{className:"animate-spin border-4 my-4 border-success border-l-transparent rounded-full w-12 h-12 inline-block align-middle m-auto mb-10"})}):b(E,{children:[t(le,{className:`${M} whitespace-nowrap table-hover`,records:B,columns:X,highlightOnHover:!0,totalRecords:Q,recordsPerPage:o,page:c,onPageChange:u,recordsPerPageOptions:f,onRecordsPerPageChange:z,sortStatus:l,onSortStatusChange:Y,selectedRecords:G,onSelectedRecordsChange:V,paginationText:({from:e,to:a,totalRecords:r})=>`Showing ${e} to ${a} of ${r} entries`}),Z&&p&&b("div",{className:"fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 p-8 bg-white shadow-md rounded z-50 border  shadow-gray-300",children:[t("div",{className:"absolute top-2 right-2 cursor-pointer",onClick:C,children:t("svg",{className:"w-6 h-6 text-gray-600 hover:text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})}),t(ce,{title:"Email Log",leftObjects:p.leftObjects,rightObjects:p.rightObjects}),t("div",{className:"mt-auto px-2 py-3 sm:flex sm:flex-row-reverse sm:px-3 my-5",children:t("button",{className:"fixed bottom-5 w-full justify-center rounded-md bg-red-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-red-500 sm:ml-3 sm:w-auto",onClick:C,children:"Close"})})]})]})})})})]})})})};export{be as G};
