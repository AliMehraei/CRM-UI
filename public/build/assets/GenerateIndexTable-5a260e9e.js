import{b as d,j as e,F as D,A as Pe,a as Ne,u as ke,a7 as Ce,f as Re,a8 as Be,d as xe,c as We,r as p,a9 as A,aa as ze,e as He,L as Ue,N as se,ab as le,ac as re,S as oe}from"./main-396129fe.js";import{s as ye,Q as Qe}from"./sortBy-2d113118.js";import{E as Ge,D as qe,V as Je}from"./CommonIcons-f41cb20c.js";import{S as _e}from"./react-select.esm-fb0506e0.js";const Ye=({option:n,handleFieldChange:s,selectedFields:f})=>d("label",{className:"flex items-center cursor-pointer",children:[e("input",{type:"checkbox",value:n.value,onChange:m=>s(m,n),checked:f.includes(n.value),className:"form-checkbox"}),e("span",{className:"text-dark",children:n.label})]}),we=({onChange:n,defaultValue:s})=>d(D,{children:[e("label",{className:"block text-sm text-gray-600",children:"From:"}),e("input",{defaultValue:s.from,type:"number",name:"from",className:"border p-2 w-full",onChange:n}),e("label",{className:"block text-sm text-gray-600",children:"To:"}),e("input",{defaultValue:s.to,type:"number",name:"to",className:"border p-2 w-full",onChange:n})]}),ce=({onChange:n,placeholder:s,defaultValue:f})=>d(D,{children:[e("label",{className:"block font-semibold",children:"Value:"}),e("input",{defaultValue:f.value,type:"text",placeholder:s,className:"border p-2 w-full",onChange:n})]}),Ze=({onChange:n,optionValue:s,defaultValue:f})=>d("div",{className:" mt-4",children:[e("label",{className:"block font-semibold",children:"Duration:"}),d("div",{className:"mb-2",children:[e("input",{type:"number",placeholder:"Days",className:"border p-2 w-1/2",min:"1",name:"duration",defaultValue:f.duration,onChange:m=>n(s,m,"is")}),d("select",{name:"duration_condition",className:"border p-2 w-1/2",placeholder:"Select a Condition",defaultValue:f.duration_condition,onChange:m=>n(s,m,"is"),children:[e("option",{value:"=",children:"="}),e("option",{value:"<",children:"<"}),e("option",{value:">",children:">"}),e("option",{value:"<=",children:"<="}),e("option",{value:">=",children:">="})]})]})]}),Y=({placeholder:n,onChange:s,label:f,defaultValue:m})=>d(D,{children:[e("label",{className:"block font-semibold",children:f}),e("input",{type:"text",placeholder:n,className:"border p-2 w-full",defaultValue:m.value,onChange:s})]}),Se=({onChange:n,defaultValue:s})=>d(D,{children:[e("label",{className:"block text-sm text-gray-600",children:"From:"}),e("input",{type:"date",name:"from",className:"border p-2 w-full",onChange:n,defaultValue:s.from}),e("label",{className:"block text-sm text-gray-600",children:"To:"}),e("input",{type:"date",name:"to",className:"border p-2 w-full",onChange:n,defaultValue:s.to})]}),Z=({onChange:n,defaultValue:s})=>e(D,{children:d("div",{className:"flex",children:[e("input",{type:"number",placeholder:"2",className:"border p-2 w-1/2",min:"1",name:"period_val",defaultValue:s.value,onChange:n}),d("select",{name:"period",className:"border p-2 w-1/2",defaultValue:s.period,onChange:n,children:[e("option",{value:"days",children:"Days"}),e("option",{value:"weeks",children:"Weeks"}),e("option",{value:"months",children:"Months"})]})]})}),W=({onChange:n,defaultValue:s})=>e(D,{children:e("input",{defaultValue:s.value,type:"date",className:"border p-2 w-full",onChange:n})}),K=({placeholder:n,loadOptions:s,onChange:f,filterSelect:m})=>{var c;const _=(c=m==null?void 0:m.value)==null?void 0:c.fullOptions,y=_==null?void 0:_.map(r=>({value:r.value,label:r.label}));return e(Pe,{defaultOptions:!0,placeholder:n,loadOptions:s,onChange:f,defaultValue:y,isMulti:!0})},X=({options:n,condition:s,optionValue:f,isMulti:m=!1,handleSelectMultipleDuration:_,handleSelectMultiple:y,defaultValue:c})=>{const r=Object.keys(n||{}).map(i=>({value:i,label:n[i]}));c=c==null?void 0:c.options;let w;return m&&Array.isArray(c)?w=c.map(i=>({value:i,label:n[i]})):!m&&c&&(w={value:c,label:n[c]}),e(_e,{placeholder:"Select an option",onChange:i=>m?y(f,i):_(f,i,s),options:r,isMulti:m,defaultValue:w})},Ke=new Ne,Xe=({filterSelect:n,option:s,setFilters:f,filters:m})=>{const _=ke(),y=n.condition,c=s.type;if(!s.condition[y]||!s.condition[y].input)return null;const r=n.value,w=(t,a)=>{const u={...m};u[t]={...u[t],value:a},_(Be({[t]:a.value})),f(u)},i=(t,a)=>{const u={value:a.target.value};w(t,u)},O=(t,a)=>{const{name:u,value:v}=a.target,g=m[t],C=g?g.value:{},x=u==="from"?v:C.from||"",N=u==="to"?v:C.to||"";w(t,{from:x,to:N})},P=(t,a)=>{const{name:u,value:v}=a.target,g=m[t],C=g?g.value:{},x=u==="period_val"?v:C.value||2,N=u==="period"?v:C.period||"day";w(t,{value:x,period:N})},F=(t,a,u="is_not")=>{let v,g,C=n.value.duration,x=n.value.duration_condition;if(a.target!=null){const{name:N,value:j}=a.target,z=m[t],k=z?z.value:{};C=N==="duration"?j:k.duration||2,x=N==="duration_condition"?j:k.duration_condition||"=",g=k.options??[]}else g=a.map(N=>N.value);u==="is_not"?v={options:g}:u==="is"&&(v={options:g,duration:C,duration_condition:x}),w(t,v)},R=(t,a)=>{let u;Array.isArray(a)?u={options:a.map(v=>v.value),fullOptions:a,relation:s==null?void 0:s.relation_model}:u={options:[a.value],fullOptions:a,relation:s==null?void 0:s.relation_model},w(t,u)},T=(t,a)=>{const u={options:a.map(v=>v.value),fullOptions:a};w(t,u)},J=async t=>{if(t.length<2)return[];const a="userId",u="name",v="avatar_data",g="email";try{const C=await Ke.loadAdminUsers({search:t});return C.status?C.data.map(x=>({value:x[a],label:d("div",{className:"flex items-center",children:[e("img",{src:Re(x[v]),alt:"avatar",className:"w-8 h-8 mr-2 rounded-full"}),d("div",{children:[e("div",{className:"text-sm font-bold",children:x[u]}),e("div",{className:"text-xs text-gray-500",children:x[g]})]})]},x[a])})):(console.error("An error occurred while fetching users",C.message),[])}catch(C){return console.error("An error occurred while fetching users:",C),[]}},M={number:{between:()=>e(we,{defaultValue:r,onChange:t=>O(s.value,t)}),not_between:()=>e(we,{defaultValue:r,onChange:t=>O(s.value,t)}),default:()=>e(ce,{defaultValue:r,onChange:t=>i(s.value,t),placeholder:"Search value"})},select2_multiple_duration:{is_not:()=>e(X,{options:s.options,condition:"is_not",optionValue:s.value,handleSelectMultipleDuration:F,isMulti:!0}),is:()=>d(D,{children:[e(X,{options:s.options,condition:"is",optionValue:s.value,isMulti:!0,defaultValue:r,handleSelectMultipleDuration:F}),e(Ze,{defaultValue:r,onChange:F,optionValue:s.value})]}),default:()=>e(ce,{defaultValue:r,onChange:t=>i(s.value,t),placeholder:"Search value that contains"})},select2_multiple_api_user:{is_not:t=>e(K,{placeholder:"Type at least 2 characters to search...",loadOptions:a=>J(a),defaultValue:r,filterSelect:n,onChange:a=>T(t.value,a)}),is:t=>e(K,{placeholder:"Type at least 2 characters to search...",loadOptions:a=>J(a),defaultValue:r,filterSelect:n,onChange:a=>T(t.value,a)}),default:t=>e(Y,{placeholder:"Search value that contains",defaultValue:r,onChange:a=>i(t.value,a),label:"Value:"})},select2_multiple_api:{is_not:t=>e(K,{placeholder:"Type at least 2 characters to search...",loadOptions:a=>Ce(a,t),defaultValue:r,filterSelect:n,onChange:a=>R(t.value,a)}),is:t=>e(K,{placeholder:"Type at least 2 characters to search...",loadOptions:a=>Ce(a,t),defaultValue:r,filterSelect:n,onChange:a=>R(t.value,a)}),default:t=>e(Y,{placeholder:"Search value that contains",defaultValue:r,onChange:a=>i(t.value,a),label:"Value:"})},select2_multiple:{is_not:()=>e(X,{options:s.options,condition:"is_not",optionValue:s.value,isMulti:!0,handleSelectMultiple:R,defaultValue:r}),is:()=>e(X,{options:s.options,condition:"is",optionValue:s.value,isMulti:!0,handleSelectMultiple:R,defaultValue:r}),default:()=>e(ce,{defaultValue:r,onChange:t=>i(s.value,t),placeholder:"Search value that contains"})},text:{between:t=>e(Se,{defaultValue:r,onChange:a=>O(t.value,a)}),in_the_last:t=>e(Z,{defaultValue:r,onChange:a=>P(t.value,a)}),due_in:t=>e(Z,{defaultValue:r,onChange:a=>P(t.value,a)}),on:t=>e(W,{defaultValue:r,onChange:a=>i(t.value,a)}),before:t=>e(W,{defaultValue:r,onChange:a=>i(t.value,a)}),after:t=>e(W,{defaultValue:r,onChange:a=>i(t.value,a)}),default:t=>e(Y,{placeholder:"Search value that contains",defaultValue:r,onChange:a=>i(t.value,a),label:"Value:"})},date:{between:t=>e(Se,{defaultValue:r,onChange:a=>O(t.value,a)}),in_the_last:t=>e(Z,{defaultValue:r,onChange:a=>P(t.value,a)}),due_in:t=>e(Z,{defaultValue:r,onChange:a=>P(t.value,a)}),on:t=>e(W,{defaultValue:r,onChange:a=>i(t.value,a)}),before:t=>e(W,{defaultValue:r,onChange:a=>i(t.value,a)}),after:t=>e(W,{defaultValue:r,onChange:a=>i(t.value,a)}),default:t=>e(Y,{placeholder:"Search value that contains",defaultValue:r,onChange:a=>i(t.value,a),label:"Value:"})}};if(M[c])return M[c][y]?M[c][y](s):M[c].default(s)},et=({option:n,handleConditionChange:s,filters:f,filterState:m,setFilters:_,filterOptionRef:y})=>{var r,w;const c=((w=(r=y==null?void 0:y.current)==null?void 0:r.filters[n.value])==null?void 0:w.condition)||null;return d("div",{children:[e("h3",{className:"text-lg font-semibold mt-4",children:"Search Options"}),d("div",{className:"mb-4",children:[d("div",{className:"mb-2",children:[d("label",{className:"block font-semibold",children:["Search include for ",n.label,":"]}),e(_e,{onChange:i=>s(n.value,i),placeholder:"Select an include",options:n.conditions,defaultValue:n.conditions.find(i=>i.value==c)})]}),f[n.value]&&e("div",{className:"mb-2",children:e(Xe,{filterOptionRef:y,filterSelect:f[n.value],option:n,setFilters:_,filters:f,filterState:m})})]})]})},lt=({modelName:n,tableColumns:s,frontRoute:f,actionPlus:m=[]})=>{const _=ke(),y=xe(l=>l.filters),{hasPermission:c,isLoading:r,isLoggedIn:w}=We(),[i,O]=p.useState(!0),[P,F]=p.useState(!0),[R,T]=p.useState(!0),[J,M]=p.useState(!1),t=new Ne,a=xe(l=>l.themeConfig.theme)==="dark",[u,v]=p.useState([]),[g,C]=p.useState([]),[x,N]=p.useState([]),[j,z]=p.useState(""),[k,H]=p.useState([]),[L,U]=p.useState(1),ee=[50,100],[$,Fe]=p.useState(ee[0]),[Q,$e]=p.useState(ye(u,"id")),[te,Ee]=p.useState(Q),[ie,ae]=p.useState([]),[Ie,Ae]=p.useState(0),[I,De]=p.useState({columnAccessor:"created_at",direction:"desc"}),E=p.useRef(),Le=async()=>{var l;try{T(!0);const h=(l=(await le("filterOption").call(t,{model:re(n)})).data)==null?void 0:l.data.map(S=>{const b=S.condition;return{...S,conditions:Object.entries(b).map(([V,q])=>({value:V,label:q.value,input:q.input,type:q.type,model:S.model}))}});C(h)}catch(o){G("Error fetching filter options.","error"),console.error("Error fetching data:",o),T(!1)}},de=()=>{window.scrollTo({top:0,behavior:"smooth"})},ue=({page:l,pageSize:o,filters:h,sortStatus:S})=>{M(!1),de(),ne(l,o,h,S)};let he=[];g&&g.length>0&&(he=g.filter(l=>l.label.toLowerCase().includes(j.toLowerCase())));const G=(l="",o="success")=>{oe.mixin({toast:!0,position:"top",showConfirmButton:!1,timer:3e3,customClass:{container:"toast"}}).fire({icon:o,title:l,padding:"10px 20px"})},pe=(l=null)=>{oe.fire({icon:"warning",title:"Are you sure?",text:"You won't be able to revert this!",showCancelButton:!0,confirmButtonText:"Delete",padding:"2em",customClass:"sweet-alerts"}).then(o=>{o.value&&(l?(me(l),ae([])):((ie||[]).map(b=>b.id).forEach(b=>me(b)),ae([]),U(1)),oe.fire({title:"Deleted!",text:"Row has been deleted.",icon:"success",customClass:"sweet-alerts"}))})},me=async l=>{try{F(!0),le(`deleteSingle${re(n)}`).call(t,l).then(o=>{const h=o.data;h.status?ue(E.current):(G(`Error deleting the ${n}: `+h.message,"error"),console.error(`Error deleting the ${n} : `,h.message))})}catch(o){G("Error making delete request","error"),console.error("Error making delete request",o),F(!1)}},ne=async(l=1,o=ee[0],h=[],S={})=>{F(!0);const{columnAccessor:b="",direction:V=""}=S,q=encodeURIComponent(JSON.stringify(h));try{le(`fetchData${re(n)}`).call(t,{page:l,pageSize:o,sortField:b,sortDirection:V,filterParam:q}).then(B=>{var fe,ge,ve,be;v((ge=(fe=B.data)==null?void 0:fe.data)==null?void 0:ge.data),Ae((be=(ve=B.data)==null?void 0:ve.data)==null?void 0:be.total)}).catch(B=>{console.error("Error fetching data: ",B),G(`Error fetching  ${n} data.`,"error")})}catch(B){G(`Error fetching ${n} data.`,"error"),console.error("Error fetching data: ",B)}},Ve=()=>{N([]),H([]),z(""),U(1),M(!0),de()},Oe=(l,o)=>{const{value:h,checked:S}=l.target;S?(H(b=>({...b,[h]:{field:h,condition:"",value:"",model:o.model,type:o.type}})),N(b=>[...b,h])):(H(b=>{const V={...b};return delete V[h],V}),N(b=>b.filter(V=>V!==h)))},Te=l=>{const{columnAccessor:o,direction:h="desc"}=l;De({columnAccessor:o,direction:h}),U(1),ne(L,$,k,{columnAccessor:o,direction:h})},Me=(l,o)=>{const h=["between","in_the_last","due_in"];let S={...k[l],condition:o.value};h.includes(S.condition)&&(S.value="");const b={...k,[l]:S};H(b)};p.useEffect(()=>{const l=ye(u,I.columnAccessor),o=I.direction!=="asc"?l.reverse():l;E.current={...E.current,sortStatus:I},$e(o)},[u,I]),p.useEffect(()=>{U(1)},[$]),p.useEffect(()=>{Ee([...Q.slice(0,$)]),E.current={...E.current,page:L,pageSize:$}},[L,$,Q]),p.useEffect(()=>{T(!0),g.length>0&&T(!1)},[g]),p.useEffect(()=>{F(!0),te.length>0&&F(!1),Q.length>0&&F(!1)},[te,Q]),p.useEffect(()=>{E.current={...E.current,page:L,pageSize:$,sortStatus:I},ne(L,$,k,I)},[L,$,I,J]),p.useEffect(()=>{E.current={...E.current,filters:k}},[k]),p.useEffect(()=>{!r&&!c(`filter-${A(n)}`)&&!c(`read-${A(n)}`)&&O(!0),O(!1)},[r,w,c]),p.useEffect(()=>{Le(),_(ze())},[]);const je=d("button",{type:"button",className:"btn btn-danger gap-2",onClick:()=>pe(),children:[d("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",children:[e("path",{d:"M20.5001 6H3.5",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"}),e("path",{d:"M18.8334 8.5L18.3735 15.3991C18.1965 18.054 18.108 19.3815 17.243 20.1907C16.378 21 15.0476 21 12.3868 21H11.6134C8.9526 21 7.6222 21 6.75719 20.1907C5.89218 19.3815 5.80368 18.054 5.62669 15.3991L5.16675 8.5",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"}),e("path",{opacity:"0.5",d:"M9.5 11L10 16",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"}),e("path",{opacity:"0.5",d:"M14.5 11L14 16",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"}),e("path",{opacity:"0.5",d:"M6.5 6C6.55588 6 6.58382 6 6.60915 5.99936C7.43259 5.97849 8.15902 5.45491 8.43922 4.68032C8.44784 4.65649 8.45667 4.62999 8.47434 4.57697L8.57143 4.28571C8.65431 4.03708 8.69575 3.91276 8.75071 3.8072C8.97001 3.38607 9.37574 3.09364 9.84461 3.01877C9.96213 3 10.0932 3 10.3553 3H13.6447C13.9068 3 14.0379 3 14.1554 3.01877C14.6243 3.09364 15.03 3.38607 15.2493 3.8072C15.3043 3.91276 15.3457 4.03708 15.4286 4.28571L15.5257 4.57697C15.5433 4.62992 15.5522 4.65651 15.5608 4.68032C15.841 5.45491 16.5674 5.97849 17.3909 5.99936C17.4162 6 17.4441 6 17.5 6",stroke:"currentColor",strokeWidth:"1.5"})]}),"Delete"]});return!c(`read-${A(n)}`)||i?e(He,{}):e(D,{children:e("div",{className:"panel px-0 border-white-light dark:border-[#1b2e4b]",children:d("div",{className:`${n}-table`,children:[e("div",{className:"mb-4.5 px-5 flex md:items-center md:flex-row flex-col gap-5",children:d("div",{className:"flex items-center gap-2",children:[c(`delete-${A(n)}`)&&je,c(`create-${A(n)}`)&&e(Ue,{to:`/${f??n}/add`,className:"btn btn-primary gap-2",children:"Add New"})]})}),d("div",{className:"grid grid-cols-7 gap-6 mb-6",children:[c(`filter-${A(n)}`)&&d("div",{className:"panel col-span-1",children:[e("h2",{className:"text-xl font-bold mb-4",children:"Filter By Fields"}),e("div",{className:"mb-4",children:e("input",{type:"text",placeholder:"Search fields...",className:"border p-2 w-full",value:j,onChange:l=>z(l.target.value)})}),d("div",{className:"mb-4",children:[e("label",{className:"block font-semibold",children:"Filter by:"}),R?e("div",{className:"flex justify-center",children:e("span",{className:"animate-spin border-4 my-4 border-success border-l-transparent rounded-full w-12 h-12 inline-block align-middle m-auto mb-10"})}):e("div",{children:he.map((l,o)=>d("div",{children:[e(Ye,{option:l,handleFieldChange:Oe,selectedFields:x}),x.includes(l.value)&&e(et,{option:l,handleConditionChange:Me,filters:k,filterState:y,setFilters:H,filterOptionRef:E})]},l.value+o))})]}),x.length>0&&d("div",{className:"flex justify-between space-x-2  ",style:{position:"fixed",left:-58,zIndex:99999,top:"50vh",transform:"rotate(90deg)"},children:[e("button",{onClick:()=>ue({page:L,pageSize:$,filters:k,sortStatus:I}),className:"btn btn-sm btn-primary",children:"Apply Filter"}),e("button",{onClick:Ve,className:"btn btn-sm btn-dark",children:"Reset"})]})]}),e("div",{className:"panel col-span-6",children:e("div",{className:"datatables pagination-padding",children:P?e("div",{className:"flex justify-center",children:e("span",{className:"animate-spin border-4 my-4 border-success border-l-transparent rounded-full w-12 h-12 inline-block align-middle m-auto mb-10"})}):e(Qe,{className:`${a} whitespace-nowrap table-hover`,records:te,columns:[...s,{accessor:"action",title:"Actions",sortable:!1,textAlignment:"center",render:({id:l})=>e(D,{children:d("div",{className:"flex gap-4 items-center w-max mx-auto",children:[c(`update-${A(n)}`)&&e(se,{to:`/${f??n}/edit/${l}`,className:"flex hover:text-info",children:e(Ge,{})}),c(`delete-${A(n)}`)&&e("button",{type:"button",className:"flex hover:text-danger",onClick:()=>pe(l),children:e(qe,{})}),c(`read-${A(n)}`)&&e(se,{to:`/${f??n}/preview/${l}`,className:"flex hover:text-info",children:e(Je,{})}),m.map((o,h)=>e(se,{to:`/${o.route}/${l}`,className:"flex hover:text-info",children:o.icon},`${l}-${h}`))]})})}],highlightOnHover:!0,totalRecords:Ie,recordsPerPage:$,page:L,onPageChange:U,recordsPerPageOptions:ee,onRecordsPerPageChange:Fe,sortStatus:I,onSortStatusChange:Te,selectedRecords:ie,onSelectedRecordsChange:ae,paginationText:({from:l,to:o,totalRecords:h})=>`Showing ${l} to ${o} of ${h} entries`})})})]})]})})})};export{lt as G};
