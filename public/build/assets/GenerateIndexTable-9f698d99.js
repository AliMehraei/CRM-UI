import{b as c,j as e,F as $,A as Qe,a as De,u as Ie,a8 as ke,a9 as _e,f as Ge,aa as qe,d as Fe,c as Je,r as d,ab as V,ac as Ye,e as Ze,L as Ke,N as re,ad as oe,ae as ce,S as ie}from"./main-763a01a7.js";import{s as $e,Q as Xe}from"./sortBy-8c40204b.js";import{E as et,D as tt,V as at}from"./CommonIcons-0598faa2.js";import{S as Ve}from"./react-select.esm-1d97a747.js";const nt=({option:n,handleFieldChange:s,selectedFields:m})=>c("label",{className:"flex items-center cursor-pointer",children:[e("input",{type:"checkbox",value:n.value,onChange:h=>s(h,n),checked:m.includes(n.value),className:"form-checkbox"}),e("span",{className:"text-dark",children:n.label})]}),Ee=({onChange:n,defaultValue:s})=>c($,{children:[e("label",{className:"block text-sm text-gray-600",children:"From:"}),e("input",{defaultValue:s.from,type:"number",name:"from",className:"border p-2 w-full",onChange:n}),e("label",{className:"block text-sm text-gray-600",children:"To:"}),e("input",{defaultValue:s.to,type:"number",name:"to",className:"border p-2 w-full",onChange:n})]}),de=({onChange:n,placeholder:s,defaultValue:m})=>c($,{children:[e("label",{className:"block font-semibold",children:"Value:"}),e("input",{defaultValue:m.value,type:"text",placeholder:s,className:"border p-2 w-full",onChange:n})]}),lt=({onChange:n,optionValue:s,defaultValue:m})=>c("div",{className:" mt-4",children:[e("label",{className:"block font-semibold",children:"Duration:"}),c("div",{className:"mb-2",children:[e("input",{type:"number",placeholder:"Days",className:"border p-2 w-1/2",min:"1",name:"duration",defaultValue:m.duration,onChange:h=>n(s,h,"is")}),c("select",{name:"duration_condition",className:"border p-2 w-1/2",placeholder:"Select a Condition",defaultValue:m.duration_condition,onChange:h=>n(s,h,"is"),children:[e("option",{value:"=",children:"="}),e("option",{value:"<",children:"<"}),e("option",{value:">",children:">"}),e("option",{value:"<=",children:"<="}),e("option",{value:">=",children:">="})]})]})]}),X=({placeholder:n,onChange:s,label:m,defaultValue:h})=>c($,{children:[e("label",{className:"block font-semibold",children:m}),e("input",{type:"text",placeholder:n,className:"border p-2 w-full",defaultValue:h.value,onChange:s})]}),Le=({onChange:n,defaultValue:s})=>c($,{children:[e("label",{className:"block text-sm text-gray-600",children:"From:"}),e("input",{type:"date",name:"from",className:"border p-2 w-full",onChange:n,defaultValue:s.from}),e("label",{className:"block text-sm text-gray-600",children:"To:"}),e("input",{type:"date",name:"to",className:"border p-2 w-full",onChange:n,defaultValue:s.to})]}),te=({onChange:n,defaultValue:s})=>e($,{children:c("div",{className:"flex",children:[e("input",{type:"number",placeholder:"2",className:"border p-2 w-1/2",min:"1",name:"period_val",defaultValue:s.value,onChange:n}),c("select",{name:"period",className:"border p-2 w-1/2",defaultValue:s.period,onChange:n,children:[e("option",{value:"days",children:"Days"}),e("option",{value:"weeks",children:"Weeks"}),e("option",{value:"months",children:"Months"})]})]})}),H=({onChange:n,defaultValue:s})=>e($,{children:e("input",{defaultValue:s.value,type:"date",className:"border p-2 w-full",onChange:n})}),U=({placeholder:n,loadOptions:s,onChange:m,filterSelect:h})=>{var g;const E=(g=h==null?void 0:h.value)==null?void 0:g.fullOptions,y=E==null?void 0:E.map(l=>({value:l.value,label:l.label}));return e(Qe,{defaultOptions:!0,placeholder:n,loadOptions:s,onChange:m,defaultValue:y,isMulti:!0})},Q=({options:n,condition:s,optionValue:m,isMulti:h=!1,handleSelectMultipleDuration:E,handleSelect:y,handleSelectMultiple:g,defaultValue:l})=>{const x=Object.keys(n||{}).map(C=>({value:C,label:n[C]}));l=l==null?void 0:l.options;let p;return h&&Array.isArray(l)?p=l.map(C=>({value:C,label:n[C]})):!h&&l&&(p={value:l,label:n[l]}),e(Ve,{placeholder:"Select an option",onChange:C=>h?g(m,C):y(m,C),options:x,isMulti:h,defaultValue:p})},st=new De,rt=({filterSelect:n,option:s,setFilters:m,filters:h})=>{const E=Ie(),y=n.condition,g=s.type;if(!s.condition[y]||!s.condition[y].input)return null;const l=n.value,x=(t,a)=>{const i={...h};i[t]={...i[t],value:a},E(qe({[t]:a.value})),m(i)},p=(t,a)=>{const i={value:a.target.value};x(t,i)},C=(t,a)=>{const{name:i,value:f}=a.target,w=h[t],v=w?w.value:{},S=i==="from"?f:v.from||"",N=i==="to"?f:v.to||"";x(t,{from:S,to:N})},R=(t,a)=>{const{name:i,value:f}=a.target,w=h[t],v=w?w.value:{},S=i==="period_val"?f:v.value||2,N=i==="period"?f:v.period||"day";x(t,{value:S,period:N})},_=(t,a,i="is_not")=>{let f,w,v=n.value.duration,S=n.value.duration_condition;if(a.target!=null){const{name:N,value:W}=a.target,z=h[t],j=z?z.value:{};v=N==="duration"?W:j.duration||2,S=N==="duration_condition"?W:j.duration_condition||"=",w=j.options??[]}else w=a.map(N=>N.value);i==="is_not"?f={options:w}:i==="is"&&(f={options:w,duration:v,duration_condition:S}),x(t,f)},ee=(t,a)=>{const i=a.value;console.log(t,i),x(t,i)},F=(t,a)=>{let i;Array.isArray(a)?i={options:a.map(f=>f.value),fullOptions:a,relation:s==null?void 0:s.relation_model}:i={options:[a.value],fullOptions:a,relation:s==null?void 0:s.relation_model},x(t,i)},B=(t,a)=>{const i={options:a.map(f=>f.value),fullOptions:a};x(t,i)},G=async t=>{if(t.length<2)return[];const a="userId",i="name",f="avatar_data",w="email";try{const v=await st.loadAdminUsers({search:t});return v.status?v.data.map(S=>({value:S[a],label:c("div",{className:"flex items-center",children:[e("img",{src:Ge(S[f]),alt:"avatar",className:"w-8 h-8 mr-2 rounded-full"}),c("div",{children:[e("div",{className:"text-sm font-bold",children:S[i]}),e("div",{className:"text-xs text-gray-500",children:S[w]})]})]},S[a])})):(console.error("An error occurred while fetching users",v.message),[])}catch(v){return console.error("An error occurred while fetching users:",v),[]}},T={number:{between:()=>e(Ee,{defaultValue:l,onChange:t=>C(s.value,t)}),not_between:()=>e(Ee,{defaultValue:l,onChange:t=>C(s.value,t)}),default:()=>e(de,{defaultValue:l,onChange:t=>p(s.value,t),placeholder:"Search value"})},select2_multiple_duration:{is_not:()=>e(Q,{options:s.options,condition:"is_not",optionValue:s.value,handleSelectMultipleDuration:_,isMulti:!0}),is:()=>c($,{children:[e(Q,{options:s.options,condition:"is",optionValue:s.value,isMulti:!0,defaultValue:l,handleSelectMultipleDuration:_}),e(lt,{defaultValue:l,onChange:_,optionValue:s.value})]}),default:()=>e(de,{defaultValue:l,onChange:t=>p(s.value,t),placeholder:"Search value that contains"})},select2_multiple_api_user:{is_not:t=>e(U,{placeholder:"Type at least 2 characters to search...",loadOptions:a=>G(a),defaultValue:l,filterSelect:n,onChange:a=>B(t.value,a)}),is:t=>e(U,{placeholder:"Type at least 2 characters to search...",loadOptions:a=>G(a),defaultValue:l,filterSelect:n,onChange:a=>B(t.value,a)}),default:t=>e(X,{placeholder:"Search value that contains",defaultValue:l,onChange:a=>p(t.value,a),label:"Value:"})},select2_multiple_api:{is_not:t=>e(U,{placeholder:"Type at least 2 characters to search...",loadOptions:a=>ke(a,t),defaultValue:l,filterSelect:n,onChange:a=>F(t.value,a)}),is:t=>e(U,{placeholder:"Type at least 2 characters to search...",loadOptions:a=>ke(a,t),defaultValue:l,filterSelect:n,onChange:a=>F(t.value,a)}),default:t=>e(X,{placeholder:"Search value that contains",defaultValue:l,onChange:a=>p(t.value,a),label:"Value:"})},select2_multiple:{is_not:()=>e(Q,{options:s.options,condition:"is_not",optionValue:s.value,isMulti:!0,handleSelectMultiple:F,defaultValue:l}),is:()=>e(Q,{options:s.options,condition:"is",optionValue:s.value,isMulti:!0,handleSelectMultiple:F,defaultValue:l}),default:()=>e(de,{defaultValue:l,onChange:t=>p(s.value,t),placeholder:"Search value that contains"})},text:{between:t=>e(Le,{defaultValue:l,onChange:a=>C(t.value,a)}),in_the_last:t=>e(te,{defaultValue:l,onChange:a=>R(t.value,a)}),due_in:t=>e(te,{defaultValue:l,onChange:a=>R(t.value,a)}),on:t=>e(H,{defaultValue:l,onChange:a=>p(t.value,a)}),before:t=>e(H,{defaultValue:l,onChange:a=>p(t.value,a)}),after:t=>e(H,{defaultValue:l,onChange:a=>p(t.value,a)}),default:t=>e(X,{placeholder:"Search value that contains",defaultValue:l,onChange:a=>p(t.value,a),label:"Value:"})},date:{between:t=>e(Le,{defaultValue:l,onChange:a=>C(t.value,a)}),in_the_last:t=>e(te,{defaultValue:l,onChange:a=>R(t.value,a)}),due_in:t=>e(te,{defaultValue:l,onChange:a=>R(t.value,a)}),on:t=>e(H,{defaultValue:l,onChange:a=>p(t.value,a)}),before:t=>e(H,{defaultValue:l,onChange:a=>p(t.value,a)}),after:t=>e(H,{defaultValue:l,onChange:a=>p(t.value,a)}),default:t=>e(X,{placeholder:"Search value that contains",defaultValue:l,onChange:a=>p(t.value,a),label:"Value:"})},select2_multiple_api_userable:{is_not:t=>c($,{children:[e(Q,{options:t.options,optionValue:t.value,isMulti:!1,defaultValue:l,handleSelect:ee}),e(U,{placeholder:"Type at least 2 characters to search...",loadOptions:a=>_e(a,t,n),defaultValue:l,filterSelect:n,onChange:a=>F(t.value,a)}),","]}),is:t=>c($,{children:[e(Q,{options:t.options,optionValue:t.value,isMulti:!1,defaultValue:l,handleSelect:ee}),e(U,{placeholder:"Type at least 2 characters to search...",loadOptions:a=>_e(a,t,n),defaultValue:l,filterSelect:n,onChange:a=>F(t.value,a)}),","]}),default:t=>e(X,{placeholder:"Search value that contains",defaultValue:l,onChange:a=>p(t.value,a),label:"Value:"})}};if(T[g])return T[g][y]?T[g][y](s):T[g].default(s)},ot=({option:n,handleConditionChange:s,filters:m,filterState:h,setFilters:E,filterOptionRef:y})=>{var l,x;const g=((x=(l=y==null?void 0:y.current)==null?void 0:l.filters[n.value])==null?void 0:x.condition)||null;return c("div",{children:[e("h3",{className:"text-lg font-semibold mt-4",children:"Search Options"}),c("div",{className:"mb-4",children:[c("div",{className:"mb-2",children:[c("label",{className:"block font-semibold",children:["Search include for ",n.label,":"]}),e(Ve,{onChange:p=>s(n.value,p),placeholder:"Select an include",options:n.conditions,defaultValue:n.conditions.find(p=>p.value==g)})]}),m[n.value]&&e("div",{className:"mb-2",children:e(rt,{filterOptionRef:y,filterSelect:m[n.value],option:n,setFilters:E,filters:m,filterState:h})})]})]})},ht=({modelName:n,tableColumns:s,frontRoute:m,actionPlus:h=[]})=>{const E=Ie(),y=Fe(r=>r.filters),{hasPermission:g,isLoading:l,isLoggedIn:x}=Je(),[p,C]=d.useState(!0),[R,_]=d.useState(!0),[ee,F]=d.useState(!0),[B,G]=d.useState(!0),[T,t]=d.useState(!1),[a,i]=d.useState(!1),f=new De,w=Fe(r=>r.themeConfig.theme)==="dark",[v,S]=d.useState([]),[N,W]=d.useState([]),[z,j]=d.useState([]),[ue,he]=d.useState(""),[A,q]=d.useState([]),[M,J]=d.useState(1),ae=[50,100],[L,Ae]=d.useState(ae[0]),[Y,Me]=d.useState($e(v,"id")),[ne,Oe]=d.useState(Y),[pe,le]=d.useState([]),[Te,je]=d.useState(0),[I,Pe]=d.useState({columnAccessor:"created_at",direction:"desc"}),D=d.useRef(),Re=async()=>{var r;try{F(!0);const u=(r=(await oe("filterOption").call(f,{model:ce(n)})).data)==null?void 0:r.data.map(k=>{const b=k.condition;return{...k,conditions:Object.entries(b).map(([O,K])=>({value:O,label:K.value,input:K.input,type:K.type,model:k.model}))}});W(u)}catch(o){Z("Error fetching filter options.","error"),console.error("Error fetching data:",o),F(!1)}},me=()=>{window.scrollTo({top:0,behavior:"smooth"})},ge=({page:r,pageSize:o,filters:u,sortStatus:k})=>{i(!1),me(),se(r,o,u,k)};let fe=[];N&&N.length>0&&(fe=N.filter(r=>r.label.toLowerCase().includes(ue.toLowerCase())));const Z=(r="",o="success")=>{ie.mixin({toast:!0,position:"top",showConfirmButton:!1,timer:3e3,customClass:{container:"toast"}}).fire({icon:o,title:r,padding:"10px 20px"})},ve=(r=null)=>{ie.fire({icon:"warning",title:"Are you sure?",text:"You won't be able to revert this!",showCancelButton:!0,confirmButtonText:"Delete",padding:"2em",customClass:"sweet-alerts"}).then(o=>{o.value&&(r?(be(r),le([])):((pe||[]).map(b=>b.id).forEach(b=>be(b)),le([]),J(1)),ie.fire({title:"Deleted!",text:"Row has been deleted.",icon:"success",customClass:"sweet-alerts"}))})},be=async r=>{try{_(!0),oe(`deleteSingle${ce(n)}`).call(f,r).then(o=>{const u=o.data;u.status?ge(D.current):(Z(`Error deleting the ${n}: `+u.message,"error"),console.error(`Error deleting the ${n} : `,u.message))})}catch(o){Z("Error making delete request","error"),console.error("Error making delete request",o),_(!1)}},se=async(r=1,o=ae[0],u=[],k={})=>{_(!0);const{columnAccessor:b="",direction:O=""}=k,K=encodeURIComponent(JSON.stringify(u));try{oe(`fetchData${ce(n)}`).call(f,{page:r,pageSize:o,sortField:b,sortDirection:O,filterParam:K}).then(P=>{var Ce,ye,xe,we,Se,Ne;S((ye=(Ce=P.data)==null?void 0:Ce.data)==null?void 0:ye.data),je((we=(xe=P.data)==null?void 0:xe.data)==null?void 0:we.total),((Ne=(Se=P.data)==null?void 0:Se.data)==null?void 0:Ne.data.length)==0?t(!0):t(!1)}).catch(P=>{console.error("Error fetching data: ",P),G(!B),Z(`Error fetching  ${n} data.`,"error")})}catch(P){Z(`Error fetching ${n} data.`,"error"),console.error("Error fetching data: ",P),G(!B)}},Be=()=>{j([]),q([]),he(""),J(1),i(!0),me()},We=(r,o)=>{const{value:u,checked:k}=r.target;k?(q(b=>({...b,[u]:{field:u,condition:"",value:"",model:o.model,type:o.type}})),j(b=>[...b,u])):(q(b=>{const O={...b};return delete O[u],O}),j(b=>b.filter(O=>O!==u)))},ze=r=>{const{columnAccessor:o,direction:u="desc"}=r;Pe({columnAccessor:o,direction:u}),J(1),se(M,L,A,{columnAccessor:o,direction:u})},He=(r,o)=>{const u=["between","in_the_last","due_in"];let k={...A[r],condition:o.value};u.includes(k.condition)&&(k.value="");const b={...A,[r]:k};q(b)};d.useEffect(()=>{const r=$e(v,I.columnAccessor),o=I.direction!=="asc"?r.reverse():r;D.current={...D.current,sortStatus:I},Me(o)},[v,I]),d.useEffect(()=>{J(1)},[L]),d.useEffect(()=>{Oe([...Y.slice(0,L)]),D.current={...D.current,page:M,pageSize:L}},[M,L,Y]),d.useEffect(()=>{F(!0),N.length>0&&F(!1)},[N]),d.useEffect(()=>{_(!0),ne.length>0&&_(!1),Y.length>0&&_(!1),T&&_(!1)},[ne,Y,B,T]),d.useEffect(()=>{D.current={...D.current,page:M,pageSize:L,sortStatus:I},se(M,L,A,I)},[M,L,I,a]),d.useEffect(()=>{D.current={...D.current,filters:A}},[A]),d.useEffect(()=>{!l&&!g(`filter-${V(n)}`)&&!g(`read-${V(n)}`)&&C(!0),C(!1)},[l,x,g]),d.useEffect(()=>{Re(),E(Ye())},[]);const Ue=c("button",{type:"button",className:"btn btn-danger gap-2",onClick:()=>ve(),children:[c("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",children:[e("path",{d:"M20.5001 6H3.5",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"}),e("path",{d:"M18.8334 8.5L18.3735 15.3991C18.1965 18.054 18.108 19.3815 17.243 20.1907C16.378 21 15.0476 21 12.3868 21H11.6134C8.9526 21 7.6222 21 6.75719 20.1907C5.89218 19.3815 5.80368 18.054 5.62669 15.3991L5.16675 8.5",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"}),e("path",{opacity:"0.5",d:"M9.5 11L10 16",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"}),e("path",{opacity:"0.5",d:"M14.5 11L14 16",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"}),e("path",{opacity:"0.5",d:"M6.5 6C6.55588 6 6.58382 6 6.60915 5.99936C7.43259 5.97849 8.15902 5.45491 8.43922 4.68032C8.44784 4.65649 8.45667 4.62999 8.47434 4.57697L8.57143 4.28571C8.65431 4.03708 8.69575 3.91276 8.75071 3.8072C8.97001 3.38607 9.37574 3.09364 9.84461 3.01877C9.96213 3 10.0932 3 10.3553 3H13.6447C13.9068 3 14.0379 3 14.1554 3.01877C14.6243 3.09364 15.03 3.38607 15.2493 3.8072C15.3043 3.91276 15.3457 4.03708 15.4286 4.28571L15.5257 4.57697C15.5433 4.62992 15.5522 4.65651 15.5608 4.68032C15.841 5.45491 16.5674 5.97849 17.3909 5.99936C17.4162 6 17.4441 6 17.5 6",stroke:"currentColor",strokeWidth:"1.5"})]}),"Delete"]});return!g(`read-${V(n)}`)||p?e(Ze,{}):e($,{children:e("div",{className:"panel px-0 border-white-light dark:border-[#1b2e4b]",children:c("div",{className:`${n}-table`,children:[e("div",{className:"mb-4.5 px-5 flex md:items-center md:flex-row flex-col gap-5",children:c("div",{className:"flex items-center gap-2",children:[g(`delete-${V(n)}`)&&Ue,g(`create-${V(n)}`)&&e(Ke,{to:`/${m??n}/add`,className:"btn btn-primary gap-2",children:"Add New"})]})}),c("div",{className:"grid grid-cols-7 gap-6 mb-6",children:[g(`filter-${V(n)}`)&&c("div",{className:"panel col-span-1",children:[e("h2",{className:"text-xl font-bold mb-4",children:"Filter By Fields"}),e("div",{className:"mb-4",children:e("input",{type:"text",placeholder:"Search fields...",className:"border p-2 w-full",value:ue,onChange:r=>he(r.target.value)})}),c("div",{className:"mb-4",children:[e("label",{className:"block font-semibold",children:"Filter by:"}),ee?e("div",{className:"flex justify-center",children:e("span",{className:"animate-spin border-4 my-4 border-primary border-l-transparent rounded-full w-12 h-12 inline-block align-middle m-auto mb-10"})}):e("div",{children:fe.map((r,o)=>c("div",{children:[e(nt,{option:r,handleFieldChange:We,selectedFields:z}),z.includes(r.value)&&e(ot,{option:r,handleConditionChange:He,filters:A,filterState:y,setFilters:q,filterOptionRef:D})]},r.value+o))})]}),z.length>0&&c("div",{className:"flex justify-between space-x-2  ",style:{position:"fixed",left:-58,zIndex:99999,top:"50vh",transform:"rotate(90deg)"},children:[e("button",{onClick:()=>ge({page:M,pageSize:L,filters:A,sortStatus:I}),className:"btn btn-sm btn-primary",children:"Apply Filter"}),e("button",{onClick:Be,className:"btn btn-sm btn-dark",children:"Reset"})]})]}),e("div",{className:"panel col-span-6",children:e("div",{className:"datatables pagination-padding",children:R?e("div",{className:"flex justify-center",children:e("span",{className:"animate-spin border-4 my-4 border-primary border-l-transparent rounded-full w-12 h-12 inline-block align-middle m-auto mb-10"})}):e(Xe,{className:`${w} whitespace-nowrap table-hover`,records:ne,columns:[...s,{accessor:"action",title:"Actions",sortable:!1,textAlignment:"center",render:({id:r})=>e($,{children:c("div",{className:"flex gap-4 items-center w-max mx-auto",children:[g(`update-${V(n)}`)&&e(re,{to:`/${m??n}/edit/${r}`,className:"flex hover:text-info",children:e(et,{})}),g(`delete-${V(n)}`)&&e("button",{type:"button",className:"flex hover:text-danger",onClick:()=>ve(r),children:e(tt,{})}),g(`read-${V(n)}`)&&e(re,{to:`/${m??n}/preview/${r}`,className:"flex hover:text-info",children:e(at,{})}),h.map((o,u)=>e(re,{to:`/${o.route}/${r}`,className:"flex hover:text-info",children:o.icon},`${r}-${u}`))]})})}],highlightOnHover:!0,totalRecords:Te,recordsPerPage:L,page:M,onPageChange:J,recordsPerPageOptions:ae,onRecordsPerPageChange:Ae,sortStatus:I,onSortStatusChange:ze,selectedRecords:pe,onSelectedRecordsChange:le,paginationText:({from:r,to:o,totalRecords:u})=>`Showing ${r} to ${o} of ${u} entries`})})})]})]})})})};export{ht as G};
