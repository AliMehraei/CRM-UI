import{a as N,u as g,r as l,e as S,b as e,j as a,n as b,q as _,L as w,c as R,h as P,s as T,g as j}from"./main-c04bb166.js";/* empty css                  */import{n as k,k as D}from"./CommonFunctions-90d107b8.js";import{$ as v}from"./transition-ddcfcc8a.js";import{_ as C}from"./dialog-bcc35c95.js";import"./sweetalert2.all-9d5da798.js";import"./use-is-mounted-917f9595.js";const O=({selectAccountModal:t,setSelectAccountModal:c,selectedAccount:r,setSelectedAccount:f})=>{const h=N(s=>s.leadForm),o=g(),[d,x]=l.useState([]),u=new S,p=s=>{f(s),o(b({selectedAccount:s.id}))};return l.useEffect(()=>{const s={account_name:{field:"account_name",condition:"is",value:{value:h.company},type:"text"}};u.fetchDataAccount({page:1,pageSize:100,sortField:"account_name",sortDirection:"desc",filterParam:encodeURIComponent(JSON.stringify(s))}).then(m=>{x(m.data.data.data)}).catch(m=>{console.error("Error fetching data: ",m)})},[]),e(v,{appear:!0,show:t,as:l.Fragment,children:a(C,{as:"div",open:t,onClose:()=>c(!1),className:"relative z-50",children:[e(v.Child,{as:l.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e("div",{className:"fixed inset-0 bg-[black]/60"})}),e("div",{className:"fixed inset-0 overflow-y-auto",children:e("div",{className:"flex min-h-full items-center justify-center px-4 py-8",children:e(v.Child,{as:l.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:a(C.Panel,{className:"panel border-0 p-0 rounded-lg overflow-hidden w-full max-w-lg text-black dark:text-white-dark",children:[e("button",{type:"button",onClick:()=>c(!1),className:"absolute top-4 ltr:right-4 rtl:left-4 text-gray-400 hover:text-gray-800 dark:hover:text-gray-600 outline-none",children:a("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[e("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})}),e("div",{className:"text-lg font-medium bg-[#fbfbfb] dark:bg-[#121c2c] ltr:pl-5 rtl:pr-5 py-3 ltr:pr-[50px] rtl:pl-[50px]",children:"Matching Account Record(s)"}),a("div",{className:"p-5",children:[a("table",{className:"table-auto overflow-scroll ",children:[e("thead",{children:a("tr",{children:[e("th",{className:"w-1",children:"Account Name"}),e("th",{className:"w-1",children:"Account Type"}),e("th",{className:"w-1",children:"Phone"}),e("th",{className:"w-1",children:"Website"})]})}),e("tbody",{children:d==null?void 0:d.map(s=>a("tr",{children:[e("td",{children:a("label",{children:[e("input",{type:"radio",name:"selectedAccount",value:s.id,checked:(r==null?void 0:r.id)===s.id,onChange:()=>p(s)}),s.account_name]})}),e("td",{children:s.account_type}),e("td",{children:s.phone}),e("td",{children:s.website})]},s.id))})]}),e("div",{className:"flex justify-end items-center mt-8",children:e("button",{disabled:r==null,type:"button",onClick:()=>c(!1),className:"btn btn-primary ltr:ml-4 rtl:mr-4",children:"Done"})})]})]})})})})]})})},z=()=>{const t=N(p=>p.leadForm),[c,r]=l.useState(!0),[f,h]=l.useState(!1),[o,d]=l.useState(null),x=g(),u=()=>{r(p=>!p)};return l.useEffect(()=>{x(b({createNewAccount:c})),c||h(!0)},[c]),a("div",{className:"space-y-5 p-10",children:[e("div",{className:"flex gap-2.5",children:a("span",{className:"font-semibold text-base ",children:["Accounts with similar details in ",e("span",{className:"font-bold",children:" Account Name"})," already exist."]})}),a("div",{className:"flex flex-col gap-4 ",children:[a("label",{className:"flex-1 items-center cursor-pointer",children:[e("input",{onChange:u,type:"radio",name:"operation",className:"form-radio",value:"false"}),a("span",{className:"text-dark dark:text-white",children:["Add to existing account :",o!=null&&e("span",{className:"mx-2 px-3 px-7 rounded-lg bg-blue-100",children:`${o==null?void 0:o.account_name}`})]})]}),a("label",{className:"flex-1 items-center cursor-pointer",children:[e("input",{onChange:u,defaultChecked:!0,type:"radio",name:"operation",className:"form-radio",value:"true"}),a("span",{className:"text-dark dark:text-white",children:["Create New Account : ",e("span",{className:"px-3 px-7 rounded-lg bg-blue-100",children:t.company})]})]}),c&&a("span",{className:"mx-3",children:["A new contact",e("span",{className:"px-3 mx-2 rounded-lg bg-blue-100",children:`${t.first_name} ${t.last_name}`}),"will be created for the Account."]})]}),e(O,{selectAccountModal:f,setSelectAccountModal:h,selectedAccount:o,setSelectedAccount:d})]})},B=()=>{const t=N(c=>c.leadForm);return a("div",{className:"space-y-5 p-10",children:[a("div",{className:"flex gap-2.5",children:[e("span",{className:"font-semibold ",children:"Create New Account"}),e("span",{className:"px-3 px-7 rounded-lg bg-blue-100",children:t.company})]}),a("div",{className:"flex gap-2.5",children:[e("span",{className:"font-semibold",children:"Create New Contact"}),a("span",{className:"px-3 px-7 rounded-lg bg-blue-100",children:[t.first_name," ",t.last_name]})]})]})},I=()=>{const t=N(r=>r.leadForm),c=_();return e("div",{className:"px-4",children:e("div",{className:"flex xl:flex-row flex-col gap-2.5",children:e("div",{className:"panel px-0 flex-1 py-6 ltr:xl:mr-6 rtl:xl:ml-6 overflow-hidden",children:a("div",{className:"mt-8 px-4",children:[a("div",{className:"flex flex-row items-center gap-2.5",children:[e("h3",{className:"font-bold text-xl ",children:"Convert Lead"}),a("span",{className:"text-sm",children:["(",`${t.first_name} ${t.last_name} - ${t.company}`,")"]})]}),e("hr",{className:"border-white-light dark:border-[#1b2e4b] my-6"}),a("div",{className:"p-3 space-y-2",children:[a("h5",{className:"font-semibold text-lg ",children:['The Lead "',t.first_name," ",t.last_name,'" converted successfully']}),a("div",{className:"flex gap-2.5 items-center",children:[e("label",{children:"Account"}),e(w,{to:`/account/edit/${t.convertResponse.account.id}`,className:"text-blue-500",children:t.convertResponse.account.account_name})]}),a("div",{className:"flex gap-2.5 items-center",children:[e("label",{children:"Contact"}),e(w,{to:`/contact/edit/${t.convertResponse.contact.id}`,className:"text-blue-500",children:t.convertResponse.contact.contact_name})]})]}),e("hr",{className:"border-white-light dark:border-[#1b2e4b] my-6"}),e("div",{className:"flex gap-2.5 px-5",children:e("button",{onClick:()=>{c("/lead/list/",{replace:!0})},className:"btn btn-outline-primary",children:"Back to leads"})})]})})})})},H=()=>{const t=N(n=>n.leadForm),{hasPermission:c}=R(),r=g(),[f,h]=l.useState(!0),[o,d]=l.useState(!1),[x,u]=l.useState(!1),s=P().id,m=new S,A=_();l.useEffect(()=>{r(T("Lead Convert"))});const E=async n=>{const i=await m.checkAccountExists({field:"account_name",value:n});if(i.status!=200)throw new Error(`Failed to check account exists. Status code: ${i.status}`);const y=i.data.exists;return r(b({accountExists:y})),y},$=async()=>{const n=await m.fetchSingleLead(s);if(n.status!=200)throw new Error(`Failed to fetch lead data. Status code: ${n.status}`);const i=n.data.data.lead;return r(b(i)),i},F=async()=>{const n=await $(),i=await E(n.company);d(i)},L=async()=>{try{const n=await m.convertLead({id:t.id,accountExists:t.accountExists,createNewAccount:t.createNewAccount,selectedAccount:t.selectedAccount});r(b({convertResponse:n.data})),u(!0),D("Lead Converted Successfully.")}catch(n){k("Failed to convert lead"),console.error(n);return}};return l.useEffect(()=>{F().then(()=>{h(!1)}).catch(n=>{k(n.message),console.error(n)})},[s]),f||!c("create-lead")?e(j,{}):x?e(I,{}):e("div",{className:"px-4",children:e("div",{className:"flex xl:flex-row flex-col gap-2.5",children:e("div",{className:"panel px-0 flex-1 py-6 ltr:xl:mr-6 rtl:xl:ml-6 overflow-hidden",children:a("div",{className:"mt-8 px-4",children:[a("div",{className:"flex flex-row items-center gap-2.5",children:[e("h3",{className:"font-bold text-xl ",children:"Convert Lead"}),a("span",{className:"text-sm",children:["(",`${t.first_name} ${t.last_name} - ${t.company}`,")"]})]}),e("hr",{className:"border-white-light dark:border-[#1b2e4b] my-6"}),o?e(z,{}):e(B,{}),a("div",{className:"flex gap-2.5 items-center",children:[e("label",{children:"Owner of the New Records"}),e("input",{id:"exchange_rate",name:"exchange_rate",type:"text",className:"flex-1 max-w-[300px] form-input disabled:pointer-events-none disabled:bg-[#eee] dark:disabled:bg-[#1b2e4b] cursor-not-allowed",disabled:!0,defaultValue:`${t.owner.first_name} ${t.owner.last_name}`})]}),e("hr",{className:"border-white-light dark:border-[#1b2e4b] my-6"}),a("div",{className:"flex gap-2.5 px-5",children:[e("button",{onClick:L,className:"btn btn-primary",children:"Convert"}),e("button",{onClick:()=>{A("/lead/list/",{replace:!0})},className:"btn btn-outline-dark",children:"Cancel"})]})]})})})})};export{H as default};
